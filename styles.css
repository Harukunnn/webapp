/* Klaro v3.3r — styles épurés, avec filterbar, chips, gantt et tabs */
:root{
  --bg:#0b1020;
  --card:rgba(17,26,51,0.88);
  --card-strong:rgba(11,18,40,0.92);
  --muted:#9db1d1;
  --text:#e8f1ff;
  --accent:#7fb4ff;
  --accent-soft:rgba(127,180,255,0.18);
  --warn:#ffc107;
  --bad:#ff6b6b;
  --ok:#4cd4a8;
  --grid:#24314d;
  --grey:#f2f4f7;
  --line:rgba(37,52,88,0.65);
  --line-soft:rgba(127,180,255,0.18);
  --surface:rgba(255,255,255,0.04);
  --surface-alt:rgba(255,255,255,0.08);
  --btn:#17305e;
  --btn2:#172034;
  --glass:rgba(10,16,35,0.72);
  --shadow:0 12px 28px rgba(0,0,0,.35);
  --shadow-lg:0 24px 48px rgba(0,0,0,.45);
  --focus-ring:rgba(127,180,255,0.65);
  --gantt-day:20px;
  --radius:12px;
  --radius-lg:18px;
  --sidebar-width:240px;
  color-scheme: dark;
}
:root[data-theme="auto"]{ color-scheme: light dark; }
:root[data-theme="light"],
:root[data-theme="auto"][data-theme-actual="light"]{
  --bg:#f6f8fc;
  --card:#ffffff;
  --card-strong:#f2f6ff;
  --muted:#4a5a70;
  --text:#0e1a2c;
  --accent:#0a58ff;
  --accent-soft:rgba(10,88,255,0.12);
  --warn:#b08900;
  --bad:#d32f2f;
  --ok:#2e7d32;
  --grid:#dce5f3;
  --grey:#f2f4f7;
  --line:#d0d7e6;
  --line-soft:rgba(10,88,255,0.16);
  --surface:rgba(10,88,255,0.06);
  --surface-alt:rgba(10,88,255,0.08);
  --btn:#f0f4ff;
  --btn2:#f4f6fa;
  --glass:rgba(255,255,255,0.82);
  --shadow:0 12px 28px rgba(13,37,77,.18);
  --shadow-lg:0 28px 56px rgba(13,37,77,.22);
  --focus-ring:rgba(10,88,255,0.45);
}
:root[data-theme="contrast"]{
  --bg:#05070b;
  --card:#0f1320;
  --card-strong:#080b16;
  --muted:#ffffff;
  --text:#ffffff;
  --accent:#ffdd00;
  --accent-soft:rgba(255,221,0,0.18);
  --warn:#ffdd00;
  --bad:#ff5c5c;
  --ok:#5cffb5;
  --grid:#1c2135;
  --grey:#f4f6ff;
  --line:rgba(255,255,255,0.35);
  --line-soft:rgba(255,221,0,0.28);
  --surface:rgba(255,221,0,0.14);
  --surface-alt:rgba(255,221,0,0.24);
  --btn:#1b233d;
  --btn2:#121a2d;
  --glass:rgba(9,12,22,0.88);
  --shadow:0 16px 32px rgba(0,0,0,0.65);
  --shadow-lg:0 32px 64px rgba(0,0,0,0.75);
  --focus-ring:rgba(255,221,0,0.65);
}
*{ box-sizing: border-box; }
html,body{ height:100%; }
body{ margin:0; font:14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--text); }
a{ color:var(--accent); text-decoration:none; }
.skip,
button,
input,
select,
textarea{ font:inherit; }
.skip{ position:absolute; left:-9999px; }
.skip:focus{ left:12px; background:#fff; color:#000; padding:8px; z-index:999; }

:focus-visible{ outline:2px solid var(--focus-ring); outline-offset:3px; }

button,
input,
select,
textarea{ border-radius:var(--radius); border:1px solid transparent; background:var(--surface); color:inherit; transition:background .2s ease,border-color .2s ease,box-shadow .2s ease; }
input:focus-visible,
select:focus-visible,
textarea:focus-visible{ background:var(--card-strong); border-color:var(--accent); box-shadow:0 0 0 2px color-mix(in srgb, var(--accent) 35%, transparent); }
button{ cursor:pointer; }

.topbar{
  position:sticky;
  top:0;
  z-index:20;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:24px;
  padding:18px 28px;
  background:var(--glass);
  backdrop-filter: blur(18px) saturate(140%);
  border-bottom:1px solid rgba(255,255,255,0.05);
  box-shadow:var(--shadow);
}
.topbar-left{ display:flex; align-items:center; gap:18px; min-width:0; }
.topbar-right{ display:flex; align-items:flex-start; gap:24px; min-width:0; }
.logo-wrap{
  width:48px; height:48px;
  border-radius:16px;
  background:radial-gradient(circle at top,var(--accent) 0%,rgba(255,255,255,0.05) 70%,rgba(0,0,0,0.4) 100%);
  display:flex; align-items:center; justify-content:center;
  box-shadow:0 8px 20px rgba(0,0,0,0.25);
}
.brand-stack{ display:flex; flex-direction:column; gap:2px; }
.brand-title{ font-size:20px; font-weight:700; letter-spacing:.04em; }
.brand-version{ font-size:11px; letter-spacing:.28em; text-transform:uppercase; color:var(--muted); }
.status-badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 14px;
  font-size:11px;
  text-transform:uppercase;
  border-radius:999px;
  background:rgba(127,180,255,0.14);
  border:1px solid rgba(127,180,255,0.28);
  color:var(--muted);
  transition:all .25s ease;
}
.status-badge.online{ background:rgba(76,212,168,0.18); border-color:rgba(76,212,168,0.4); color:var(--ok); }
.status-badge .dot{ width:8px; height:8px; border-radius:50%; background:currentColor; position:relative; }
.status-badge .dot.pulse::after{
  content:'';
  position:absolute;
  inset:-6px;
  border-radius:50%;
  border:2px solid currentColor;
  opacity:0;
  animation:statusPulse 2.4s infinite;
}
.notifications{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.12);
  background:rgba(255,255,255,0.06);
  color:var(--text);
  font-size:13px;
  transition:all .2s ease;
}
.notifications .badge{
  min-width:28px;
  padding:2px 8px;
  border-radius:999px;
  background:var(--bad);
  color:#0b1020;
  font-weight:600;
  text-align:center;
}
.notifications.has-alert{ box-shadow:0 0 0 2px rgba(255,107,107,0.35); }
.notifications[data-count="0"] .badge{ background:rgba(255,255,255,0.2); color:var(--muted); }
.nav-stack{ display:flex; flex-direction:column; gap:12px; min-width:0; }
.primary-nav{ display:flex; flex-wrap:wrap; gap:8px; }
.nav-btn{
  position:relative;
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:10px 18px;
  border-radius:14px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.08);
  color:var(--muted);
  font-weight:500;
  cursor:pointer;
  transition:color .2s ease, background .2s ease, border-color .2s ease;
  overflow:hidden;
}
.nav-btn::after{
  content:'';
  position:absolute;
  left:18px; right:18px; bottom:8px;
  height:3px;
  border-radius:999px;
  background:linear-gradient(90deg,var(--accent),var(--ok));
  transform:scaleX(0);
  transform-origin:left;
  transition:transform .3s ease;
}
.nav-btn[data-visited="true"]{ border-color:rgba(127,180,255,0.28); }
.nav-btn[data-visited="true"]::before{
  content:'';
  position:absolute;
  inset:0;
  border-radius:inherit;
  border:1px solid rgba(127,180,255,0.16);
  pointer-events:none;
}
.nav-btn.active{
  color:var(--text);
  background:var(--accent-soft);
  border-color:rgba(127,180,255,0.45);
}
.nav-btn.active::after{ transform:scaleX(1); }
.nav-btn:hover{ color:var(--text); }
.nav-btn.pulse{ animation:navPulse .6s ease; }
.nav-drawer{
  background:rgba(255,255,255,0.03);
  border:1px solid rgba(255,255,255,0.06);
  border-radius:16px;
  padding:12px;
  max-height:0;
  overflow:hidden;
  opacity:0;
  transform:translateY(-8px);
  transition:max-height .3s ease, opacity .3s ease, transform .3s ease;
}
.nav-drawer.open{ max-height:160px; opacity:1; transform:none; }
.drawer-panel{ display:none; }
.drawer-panel.visible{ display:block; }
.drawer-title{ font-size:12px; font-weight:600; text-transform:uppercase; letter-spacing:.18em; color:var(--muted); margin-bottom:8px; }
.drawer-buttons{ display:flex; flex-wrap:wrap; gap:8px; }
.subnav-btn{
  padding:6px 14px;
  border-radius:999px;
  border:1px solid rgba(127,180,255,0.22);
  background:transparent;
  color:var(--muted);
  font-size:12px;
  transition:all .2s;
}
.subnav-btn:hover,
.subnav-btn:focus-visible{ color:var(--text); border-color:rgba(127,180,255,0.45); outline:none; }
.subnav-btn.active{ background:var(--accent-soft); color:var(--text); border-color:rgba(127,180,255,0.45); }
.toolbar{ display:flex; align-items:center; gap:12px; }

.footer{
  padding:18px 24px;
  border-top:1px solid var(--line);
  color:var(--muted);
  text-align:center;
  background:var(--card-strong);
}
main{ padding:32px 40px 48px; max-width:1200px; margin:0 auto; transition:margin .3s ease, padding .3s ease; }
.toolbar button{
  border-radius:12px;
  padding:10px;
  background:var(--surface);
  border:1px solid color-mix(in srgb, var(--line) 60%, transparent);
  color:var(--text);
}
.toolbar button:hover{
  transform:none;
  border-color:color-mix(in srgb, var(--accent) 40%, var(--line));
}

body.sidebar-expanded .nav-stack{
  position:fixed;
  top:120px;
  left:40px;
  width:var(--sidebar-width);
  padding:8px 0;
}
body.sidebar-expanded .primary-nav{ flex-direction:column; align-items:stretch; }
body.sidebar-expanded .primary-nav .nav-btn{ width:100%; justify-content:flex-start; }
body.sidebar-expanded .nav-drawer{ max-width:var(--sidebar-width); }
body.sidebar-expanded main{ margin-left:calc(var(--sidebar-width) + 72px); }
body.sidebar-collapsed .nav-stack{ transform:translateX(-140%); opacity:0; pointer-events:none; transition:transform .3s ease, opacity .3s ease; }
body.sidebar-collapsed main{ margin-left:0; }

@media (max-width:960px){
  body.sidebar-expanded .nav-stack{
    top:auto;
    bottom:0;
    left:0;
    right:0;
    width:100%;
    padding:14px 16px 20px;
    border-radius:24px 24px 0 0;
    box-shadow:0 -20px 40px rgba(0,0,0,0.4);
  }
  body.sidebar-expanded .primary-nav{ flex-direction:row; flex-wrap:nowrap; justify-content:space-between; }
  body.sidebar-expanded .primary-nav .nav-btn{ flex:1; justify-content:center; padding:12px 10px; font-size:13px; }
  body.sidebar-expanded .nav-drawer{ order:-1; max-width:100%; }
  main{ margin-left:0 !important; padding:28px 20px 120px; }
}
.view{ display:none; }
.view.show{ display:block; animation: fade .18s ease-out; }
@keyframes fade{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }
@keyframes navPulse{ from{transform:scale(0.92);} 60%{transform:scale(1.05);} to{transform:scale(1);} }
@keyframes statusPulse{ from{opacity:0.7; transform:scale(0.6);} 60%{opacity:0; transform:scale(1.4);} to{opacity:0; transform:scale(1.6);} }

.kpi-area{
  display:grid;
  gap:18px;
  grid-template-columns:minmax(0,2fr) minmax(0,1fr);
  grid-template-areas:
    "hero alert"
    "secondary alert";
  align-items:stretch;
  margin:28px 0 36px;
}
.kpi-hero{
  grid-area:hero;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
}
.kpi-secondary{
  grid-area:secondary;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:12px;
}
.card{
  position:relative;
  background:var(--card);
  border:1px solid color-mix(in srgb, var(--line) 70%, transparent);
  border-radius:var(--radius-lg);
  padding:22px 24px;
  box-shadow:var(--shadow);
  transition:transform .25s ease, box-shadow .25s ease, border-color .25s ease;
}
.card:hover{
  transform:translateY(-2px);
  box-shadow:var(--shadow-lg);
  border-color:color-mix(in srgb, var(--accent) 35%, var(--line));
}
.card.hero{
  background:
    radial-gradient(circle at 110% -20%, color-mix(in srgb, var(--accent) 32%, transparent) 0%, transparent 60%),
    linear-gradient(160deg, color-mix(in srgb, var(--accent) 22%, transparent) 0%, transparent 60%),
    var(--card-strong);
  border-color:color-mix(in srgb, var(--accent) 35%, var(--line));
}
.card.secondary{
  background:linear-gradient(160deg, color-mix(in srgb, var(--accent) 12%, transparent) 0%, transparent 80%), var(--card);
}
.card.alert{
  grid-area:alert;
  background:linear-gradient(160deg, rgba(255,107,107,0.2) 0%, transparent 70%), var(--card-strong);
  border-color:color-mix(in srgb, var(--bad) 45%, var(--line));
}
.card.alert::after{
  content:'';
  position:absolute;
  inset:-20%;
  background:radial-gradient(circle, rgba(255,107,107,0.28) 0%, transparent 65%);
  opacity:0;
  animation:alertGlow 3s ease-in-out infinite;
  pointer-events:none;
}
@keyframes alertGlow{
  0%,100%{ opacity:0; transform:scale(0.85); }
  40%{ opacity:1; transform:scale(1); }
}
.card header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-bottom:12px;
}
button.info{
  min-width:28px;
  height:28px;
  border-radius:50%;
  border:1px solid color-mix(in srgb, var(--accent) 45%, transparent);
  background:var(--surface);
  color:var(--accent);
  font-weight:600;
  font-size:0.82rem;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  transition:background .2s ease, transform .2s ease;
}
button.info:hover,
button.info:focus-visible{
  background:color-mix(in srgb, var(--accent) 18%, var(--surface));
  transform:translateY(-1px);
}
.kpi-label{
  font-size:0.82rem;
  letter-spacing:.08em;
  text-transform:uppercase;
  color:var(--muted);
}
.kpi-value{
  font-size:2.1rem;
  font-weight:700;
  margin:4px 0;
}
.kpi-trend{
  font-size:0.85rem;
  color:var(--muted);
}
.kpi-trend.positive{ color:var(--ok); }
.kpi-trend.negative{ color:var(--bad); }
.kpi-trend.neutral{ color:var(--muted); }

.dash-filters{
  display:flex;
  flex-direction:column;
  gap:20px;
  margin:24px 0 32px;
  padding:24px 26px;
  background:var(--card-strong);
  border:1px solid var(--line);
  border-radius:var(--radius-lg);
  box-shadow:var(--shadow);
}
.filter-grid{
  display:grid;
  grid-template-columns:minmax(0,2.2fr) repeat(2,minmax(0,1fr));
  gap:18px;
}
.filter-field{
  display:flex;
  flex-direction:column;
  gap:12px;
}
.filter-field .field-title{
  font-size:0.85rem;
  text-transform:uppercase;
  letter-spacing:.12em;
  color:var(--muted);
}
.range-picker{
  display:grid;
  grid-template-columns:minmax(0,1fr) auto minmax(0,1fr);
  align-items:center;
  gap:12px;
}
.range-sep{
  font-size:1.1rem;
  color:var(--muted);
  padding-top:18px;
}
.preset-row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}
.preset{
  border-radius:999px;
  padding:6px 14px;
  border:1px solid var(--line);
  background:var(--surface);
  color:var(--muted);
  font-size:0.85rem;
  transition:background .2s ease, color .2s ease, border-color .2s ease;
}
.preset:hover,
.preset:focus-visible{
  color:var(--text);
  border-color:color-mix(in srgb, var(--accent) 45%, var(--line));
}
.preset.active{
  background:var(--accent-soft);
  color:var(--text);
  border-color:color-mix(in srgb, var(--accent) 55%, var(--line));
}
.filter-meta{
  display:flex;
  flex-wrap:wrap;
  gap:16px;
  align-items:center;
  justify-content:space-between;
}
.filter-chips{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  min-height:28px;
}
.filter-actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:flex-end;
}
.chip{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:4px 12px;
  border-radius:999px;
  background:var(--surface);
  border:1px solid var(--line);
  color:var(--text);
  font-size:0.82rem;
}
.chip button{
  border:none;
  background:transparent;
  color:var(--muted);
  padding:0;
  border-radius:50%;
  width:18px;
  height:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:background .2s ease, color .2s ease;
}
.chip button:hover,
.chip button:focus-visible{
  background:var(--accent);
  color:#0b1020;
}

label.floating{
  position:relative;
  display:block;
  padding-top:18px;
  font-size:0.9rem;
  color:var(--muted);
}
label.floating input,
label.floating select,
label.floating textarea{
  width:100%;
  padding:16px 14px 10px;
  border-radius:var(--radius);
  border:1px solid var(--line);
  background:var(--card);
  color:inherit;
  transition:border-color .2s ease, box-shadow .2s ease, background .2s ease;
}
label.floating textarea{ min-height:96px; resize:vertical; }
label.floating input:focus-visible,
label.floating select:focus-visible,
label.floating textarea:focus-visible{
  border-color:var(--accent);
  box-shadow:0 0 0 2px color-mix(in srgb, var(--accent) 28%, transparent);
  background:var(--card-strong);
}
label.floating .label-text{
  position:absolute;
  left:16px;
  top:50%;
  transform:translateY(-50%);
  padding:0 6px;
  border-radius:999px;
  background:var(--card-strong);
  color:var(--muted);
  font-size:0.78rem;
  letter-spacing:.08em;
  text-transform:uppercase;
  pointer-events:none;
  transition:transform .2s ease, color .2s ease, background .2s ease;
}
label.floating.is-filled .label-text,
label.floating:focus-within .label-text{
  transform:translateY(-150%);
  background:var(--bg);
  color:var(--accent);
}
label.floating.has-error input,
label.floating.has-error select,
label.floating.has-error textarea{
  border-color:var(--bad);
  box-shadow:0 0 0 2px color-mix(in srgb, var(--bad) 28%, transparent);
}
label.floating .field-msg{
  display:block;
  margin-top:6px;
  font-size:0.8rem;
  color:var(--bad);
}

.panel{
  background:var(--card-strong);
  border:1px solid var(--line);
  border-radius:var(--radius-lg);
  margin:24px 0;
  box-shadow:var(--shadow);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  transition:box-shadow .25s ease, border-color .25s ease, transform .25s ease;
}
.panel:hover{
  box-shadow:var(--shadow-lg);
  border-color:color-mix(in srgb, var(--accent) 40%, var(--line));
}
.panel-head{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:16px;
  padding:22px 26px 18px;
}
.panel-heading-text h2{
  margin:0;
  font-size:1.2rem;
  letter-spacing:.01em;
}
.panel-summary{
  margin:8px 0 0;
  color:var(--muted);
  font-size:0.9rem;
}
.panel-toggle{
  width:38px;
  height:38px;
  border-radius:50%;
  border:1px solid var(--line);
  background:var(--surface);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  transition:background .2s ease, transform .2s ease;
}
.panel-toggle .chevron{
  position:relative;
  width:12px;
  height:12px;
}
.panel-toggle .chevron::before{
  content:'';
  position:absolute;
  inset:0;
  border:2px solid currentColor;
  border-left:none;
  border-top:none;
  transform:rotate(45deg);
  transition:transform .2s ease;
}
.panel-toggle:hover,
.panel-toggle:focus-visible{
  background:var(--accent-soft);
}
.panel.collapsed .panel-toggle .chevron::before{
  transform:rotate(-135deg);
}
.panel-tabs{
  display:flex;
  align-items:center;
  gap:10px;
  padding:0 26px 12px;
  background:linear-gradient(180deg, color-mix(in srgb, var(--accent) 8%, transparent), transparent 60%);
  border-bottom:1px solid var(--line);
}
.panel-tabs.single{ display:none; }
.panel-tab{
  border-radius:999px;
  padding:8px 18px;
  border:1px solid var(--line);
  background:var(--surface);
  color:var(--muted);
  font-size:0.88rem;
  transition:background .2s ease, color .2s ease, border-color .2s ease;
}
.panel-tab:hover,
.panel-tab:focus-visible{
  color:var(--text);
  border-color:color-mix(in srgb, var(--accent) 45%, var(--line));
}
.panel-tab.active{
  background:var(--accent-soft);
  color:var(--text);
  border-color:color-mix(in srgb, var(--accent) 60%, var(--line));
}
.panel-body{
  padding:22px 26px 26px;
  display:flex;
  flex-direction:column;
  gap:20px;
}
.panel.collapsed .panel-body{ display:none; }
.panel-pane{
  display:none;
  animation:panelFade .2s ease;
}
.panel-pane.show{
  display:block;
}
@keyframes panelFade{
  from{ opacity:0; transform:translateY(6px); }
  to{ opacity:1; transform:none; }
}
.insight-list{
  list-style:none;
  margin:0;
  padding:0;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.insight-list li{
  padding:10px 14px;
  border-radius:var(--radius);
  background:var(--surface);
  border:1px solid var(--line);
}
.panel-pane canvas,
.panel-pane table,
.panel-pane .grid,
.panel-pane .gantt{
  margin-top:14px;
}
.panel-pane canvas{
  display:block;
  max-width:100%;
  background:var(--surface);
  border-radius:var(--radius);
  padding:12px;
  box-shadow:inset 0 0 0 1px color-mix(in srgb, var(--line) 60%, transparent);
}

.grid{
  display:grid;
  gap:16px;
}
.grid-2{ grid-template-columns:repeat(2,minmax(0,1fr)); }
.grid-3{ grid-template-columns:repeat(3,minmax(0,1fr)); }

.list-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:16px;
  margin-bottom:16px;
}
.list-header .right{
  display:flex;
  align-items:center;
  gap:12px;
}
.searchbox{
  width:260px;
  padding:10px 14px;
  border-radius:var(--radius);
  border:1px solid var(--line);
  background:var(--card-strong);
  color:inherit;
}

button{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  padding:10px 18px;
  border-radius:999px;
  border:1px solid var(--line);
  background:var(--surface);
  color:inherit;
  font-weight:500;
  transition:transform .2s ease, background .2s ease, border-color .2s ease, color .2s ease;
}
button:hover{
  transform:translateY(-1px);
  border-color:color-mix(in srgb, var(--accent) 35%, var(--line));
}
button.primary{
  background:var(--accent);
  color:#081020;
  border-color:transparent;
}
button.primary:hover{
  box-shadow:0 10px 20px rgba(127,180,255,0.25);
}
button.secondary{
  background:var(--surface);
  color:var(--muted);
}
button.ghost{
  background:transparent;
  color:var(--muted);
}
button.danger{
  background:rgba(255,107,107,0.14);
  border-color:color-mix(in srgb, var(--bad) 45%, transparent);
  color:var(--bad);
}

.form{
  position:relative;
  background:var(--card-strong);
  border:1px solid var(--line);
  border-radius:var(--radius-lg);
  padding:26px;
  margin-bottom:28px;
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
  gap:22px;
}
.form.collapsed{ display:none; }
.form-actions{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  justify-content:flex-end;
}
.form-context{
  align-self:flex-end;
  max-width:320px;
  background:var(--surface);
  border:1px dashed var(--line);
  border-radius:var(--radius);
  padding:16px;
  font-size:0.85rem;
  color:var(--muted);
}
.form-progress{
  position:relative;
  width:100%;
  background:var(--surface);
  border:1px solid var(--line);
  border-radius:999px;
  padding:6px 14px;
  display:flex;
  align-items:center;
  gap:12px;
}
.form-progress-bar{
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:var(--form-progress,0);
  border-radius:999px;
  background:linear-gradient(90deg, var(--accent), var(--ok));
  transition:width .3s ease;
}
.form-progress-label{
  position:relative;
  font-size:0.82rem;
  color:var(--muted);
}
.form-section{
  border:1px solid var(--line);
  border-radius:var(--radius);
  padding:0;
  background:var(--surface);
}
.form-section[open]{
  border-color:color-mix(in srgb, var(--accent) 35%, var(--line));
}
.form-section summary{
  padding:14px 18px;
  font-weight:600;
  cursor:pointer;
  list-style:none;
}
.form-section summary::marker{ display:none; }
.form-section > *:not(summary){
  padding:0 18px 18px;
}

.table-wrapper{
  border:1px solid var(--line);
  border-radius:var(--radius-lg);
  overflow:auto;
  background:var(--card-strong);
}
.table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  min-width:100%;
}
.table thead th{
  position:relative;
  padding:12px 16px;
  font-size:0.82rem;
  text-transform:uppercase;
  letter-spacing:.12em;
  text-align:left;
  background:linear-gradient(135deg, color-mix(in srgb, var(--accent) 25%, transparent) 0%, transparent 80%);
  color:var(--text);
  border-bottom:1px solid var(--line);
}
.table thead th + th{
  border-left:1px solid var(--line-soft);
}
.table thead th[data-sort]{
  cursor:pointer;
  padding-right:26px;
}
.table thead th[data-sort]::after{
  content:'';
  position:absolute;
  right:12px;
  top:50%;
  width:0;
  height:0;
  border:5px solid transparent;
  border-top-color:color-mix(in srgb, var(--muted) 80%, transparent);
  transform:translateY(-50%);
  opacity:0.5;
  transition:transform .2s ease, opacity .2s ease;
}
.table thead th[data-sort].asc::after{
  border-top-color:var(--accent);
  transform:translateY(-50%) rotate(180deg);
  opacity:1;
}
.table thead th[data-sort].desc::after{
  border-top-color:var(--accent);
  opacity:1;
}
.table tbody tr{
  background:var(--card);
  transition:background .2s ease;
}
.table tbody tr:nth-child(even){
  background:color-mix(in srgb, var(--card) 70%, transparent);
}
.table tbody tr:hover{
  background:color-mix(in srgb, var(--accent) 10%, var(--card));
}
.table tbody td{
  padding:12px 16px;
  border-bottom:1px solid var(--line);
  vertical-align:middle;
}
.table tbody td + td{
  border-left:1px solid var(--line-soft);
}
.table tbody tr:last-child td{
  border-bottom:none;
}
.table tbody tr.hier-focus{
  position:relative;
  box-shadow:inset 0 0 0 2px color-mix(in srgb, var(--accent) 65%, transparent);
}
.table tbody tr.hier-ancestor{
  background:color-mix(in srgb, var(--accent) 14%, var(--card));
}
.table tbody tr.hier-descendant{
  background:color-mix(in srgb, var(--accent) 10%, var(--card));
}
.table tbody tr.hier-focus:hover{
  background:color-mix(in srgb, var(--accent) 22%, var(--card));
}
.table tbody tr.hier-ancestor:hover,
.table tbody tr.hier-descendant:hover{
  background:color-mix(in srgb, var(--accent) 18%, var(--card));
}
.cell-primary{
  display:flex;
  align-items:center;
  gap:12px;
  position:relative;
}
.cell-avatar{
  width:36px;
  height:36px;
  border-radius:50%;
  background:var(--surface);
  border:1px solid var(--line);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:600;
  letter-spacing:.08em;
}
.cell-text{ flex:1; }
.quick-action{
  position:absolute;
  right:0;
  top:50%;
  transform:translateY(-50%);
  padding:6px 14px;
  border-radius:999px;
  font-size:0.78rem;
  opacity:0;
  pointer-events:none;
  transition:opacity .2s ease, transform .2s ease;
}
.table tbody tr:hover .quick-action{
  opacity:1;
  pointer-events:auto;
  transform:translateY(-50%) translateX(-4px);
}
.cell-with-progress{
  position:relative;
  padding-right:48px;
}
.cell-progress{
  position:absolute;
  inset:8px 12px;
  border-radius:999px;
  background:var(--surface);
}
.cell-progress::before{
  content:'';
  position:absolute;
  inset:2px;
  border-radius:999px;
  background:linear-gradient(90deg, var(--accent), var(--ok));
  width:var(--progress,0);
}
.cell-progress-label{
  position:relative;
  font-size:0.82rem;
}

.table .ro{ color:#9db1d1; background:#0a1630; }
.selectcol{ width:38px; text-align:center; }

.bulkbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
  background:var(--surface);
  border:1px dashed var(--line);
  border-radius:var(--radius);
  padding:10px 16px;
  margin:12px 0;
}

@media (max-width:1200px){
  .grid-3{ grid-template-columns:repeat(2,minmax(0,1fr)); }
}
@media (max-width:1024px){
  .kpi-area{ grid-template-columns:1fr; grid-template-areas:"hero" "secondary" "alert"; }
  .card.alert{ order:3; }
  .filter-grid{ grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); }
  .filter-meta{ align-items:flex-start; }
}
@media (max-width:768px){
  .grid-2,
  .grid-3{ grid-template-columns:1fr; }
  .panel-head{ padding:18px 20px 14px; flex-direction:column; align-items:flex-start; }
  .panel-body{ padding:18px 20px 22px; }
  .panel-tabs{ padding:0 20px 10px; }
  .filter-actions{ justify-content:flex-start; }
  .searchbox{ width:100%; }
  .form{ padding:22px 18px; }
  .form-context{ align-self:stretch; }
  .kpi-hero{ grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); }
}
@media (max-width:540px){
  .filter-actions button,
  .form-actions button{ flex:1 1 100%; }
  .panel-tabs{ overflow-x:auto; }
}

.bad{ color: var(--bad); }
.ok{ color: var(--ok); }
.muted{ color: var(--muted); }

/* Hide ID columns globally */
.col-id{
  display:none;
}
.table thead th.col-id{
  display:none;
}

/* Wrapper for no-end-date checkbox */
.no-date-wrapper{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:12px;
  margin-top:4px;
  color:var(--muted);
}
.no-date-wrapper input[type=checkbox]{
  margin:0 4px 0 0;
}

fieldset.objective-editor{
  margin:12px 0;
  border:1px dashed var(--line);
  border-radius:10px;
  padding:12px;
  background:rgba(20,32,58,0.45);
}
fieldset.objective-editor legend{
  font-weight:600;
  padding:0 6px;
}
.objective-items{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin:8px 0 12px 0;
}
.objective-item{
  display:grid;
  grid-template-columns: minmax(140px, 170px) 1fr auto;
  gap:8px;
  align-items:center;
}
.objective-item select,
.objective-item input{
  width:100%;
}
.objective-item button{
  height:100%;
}
@media (max-width:640px){
  .objective-item{
    grid-template-columns: 1fr;
  }
  .objective-item button{
    justify-self:flex-start;
  }
}
@media (max-width:480px){
  .objective-items{
    gap:6px;
  }
  .objective-item{
    gap:6px;
  }
  .objective-item button{
    width:100%;
  }
}
.field-hint{
  display:block;
  margin-top:4px;
  font-size:12px;
  color:var(--muted);
}
.parent-tags{
  font-size:11px;
  color:var(--muted);
  margin-top:2px;
}
.parent-tags button,
.child-tags button{
  background:none;
  border:none;
  color:var(--accent);
  cursor:pointer;
  padding:0;
  font-size:inherit;
  text-decoration:underline;
}
.parent-tags button:focus,
.child-tags button:focus{
  outline:2px solid var(--accent);
  outline-offset:2px;
}
.child-tags{
  font-size:11px;
  color:var(--muted);
  margin-top:2px;
}

/* Filter bar */
.filterbar{ padding:8px 0 2px 0; }
.filterbar .filters-row, .filterbar .sort-row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:.25rem 0 .5rem 0;}
.filterbar .chips{ display:flex; gap:6px; flex-wrap:wrap; min-height:20px; margin-bottom:4px;}
.hierarchy-toolbar{
  display:flex;
  gap:12px;
  align-items:center;
  flex-wrap:wrap;
  margin:.25rem 0 .5rem;
}
.hierarchy-toolbar label{
  display:flex;
  flex-direction:column;
  gap:4px;
  font-size:13px;
}
.hierarchy-toolbar label.inline{
  flex-direction:row;
  align-items:center;
  font-weight:500;
  gap:6px;
}
.hierarchy-toolbar button{
  align-self:flex-start;
}
@media (max-width:640px){
  .hierarchy-toolbar{
    flex-direction:column;
    align-items:flex-start;
  }
  .hierarchy-toolbar button{
    width:100%;
  }
}
.chip{ background:var(--btn); color:var(--text); border-radius:999px; padding:2px 8px; display:inline-flex; gap:6px; align-items:center; }
.chip button{ background:none; border:none; color:inherit; cursor:pointer; }

.checkbox-grid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap:6px 12px;
  margin:12px 0;
}
.checkbox-grid label{
  display:flex;
  align-items:flex-start;
  gap:6px;
  font-size:13px;
}
.checkbox-grid input[type=checkbox]{
  width:auto;
}
@media (max-width:520px){
  .checkbox-grid{
    grid-template-columns:1fr;
  }
}

/* Tabs in Params */
.tabs{ display:flex; gap:8px; margin:12px 0; border-bottom:1px solid var(--line); }
.tab{ border:none; background:var(--btn2); color:var(--text); padding:6px 10px; border-top-left-radius:6px; border-top-right-radius:6px; cursor:pointer; }
.tab.active{ background:var(--btn); }
.tabpanel{ display:none; }
.tabpanel.show{ display:block; }

/* Gantt */
.gantt{ border:1px solid var(--line); border-radius:8px; background:var(--card); overflow:auto; }
.gantt .header{ display:flex; gap:2px; position:sticky; top:0; background:var(--card); padding:6px; border-bottom:1px solid var(--line); z-index:1; }
.gantt .header .day{ width: var(--gantt-day); height:14px; border:1px solid #0d1a33; background:#0b152d; }
:root[data-theme="light"] .gantt .header .day{ width: var(--gantt-day); border-color:#d4ddf0; background:#f5f8ff; }
.gantt .row{ display:flex; align-items:center; gap:4px; padding:4px 6px; border-bottom:1px solid var(--line); position:relative; }
.gantt .name{ width:240px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.gantt .timeline{ position:relative; height:18px; min-width:1150px; }
.gantt .bar{ position:absolute; height:14px; border-radius:6px; background:var(--accent); opacity:.9; }

/* Colour coding for Gantt bars based on project status. These classes are applied
   dynamically in app.js using the status of each project. Feel free to adjust
   the colours to match your theme. */
.gantt .bar.status-idea{ background:#9c27b0; }
.gantt .bar.status-planned{ background:#2196f3; }
.gantt .bar.status-progress{ background:#4caf50; }
.gantt .bar.status-blocked{ background:#ff9800; }
.gantt .bar.status-done{ background:#9e9e9e; }
.gantt .bar.status-cancelled{ background:#795548; }

/* Mise en évidence des projets à faible énergie. Si la colonne
   d'énergie d'un projet contient une classe "low-energy", on change
   la couleur du texte pour attirer l'attention et on applique un fond
   légèrement accentué afin de signaler qu'une pause structurée est
   recommandée. */
.energy-cell.low-energy{
  color:#ff6b6b;
  font-weight:bold;
  background:rgba(255,107,107,0.15);
}

.time-cell{
  cursor:pointer;
  color:var(--accent);
  font-weight:600;
}
.time-cell:hover{
  text-decoration:underline;
}
.time-cell:focus{
  outline:2px solid var(--accent);
  outline-offset:2px;
}

.timer-modal{
  position:fixed;
  inset:0;
  background:rgba(5,10,20,0.72);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:100;
}
.timer-modal[hidden]{
  display:none !important;
}
.timer-dialog{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:12px;
  padding:24px;
  width:min(340px, 92vw);
  text-align:center;
  box-shadow:0 12px 26px rgba(0,0,0,0.35);
}
.timer-countdown{
  font-size:2.5rem;
  font-weight:700;
  margin:12px 0 6px;
}
.timer-controls{
  display:flex;
  justify-content:center;
  gap:12px;
  flex-wrap:wrap;
  margin-top:12px;
}
.timer-controls button{
  min-width:90px;
}

/* Icône de tendance pour les KPI (flèches de variation) */
.trend-icon{
  margin-left:4px;
  font-size:16px;
  vertical-align:middle;
}
.trend-icon.ok{ color: var(--ok); }
.trend-icon.bad{ color: var(--bad); }
.trend-icon.muted{ color: var(--muted); }

/* Mise en évidence des projets en hibernation (faible contribution, énergie faible ou état stagnant).
   On applique une teinte rose clair sur toute la ligne pour signaler la mise en pause structurée. */
tr.hibernation{
  background-color: rgba(255, 186, 186, 0.12);
}
.gantt .today{ position:absolute; width:2px; height:100%; background:#ffcf5a; top:0; }
.gantt .weekend{ position:absolute; top:0; bottom:0; background:linear-gradient(90deg, rgba(255,255,255,.05), rgba(255,255,255,.05)); }

/* Report view */
#reportView{ display:none; background:white; color:black; padding:16px; }
#reportView.show{ display:block; }

.toast{ position:fixed; bottom:16px; right:16px; background:rgba(0,0,0,.8); color:white; padding:10px 12px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.25); }
:root[data-theme="light"] .toast{ background:rgba(30,30,30,.95); }

/* Cellule de statut cliquable pour les actions (toggle À faire/Fait) */
.status-toggle{
  cursor: pointer;
  text-decoration: underline;
}

/* Badge pour afficher le score de priorité des actions. Utilisé dans la
   colonne "Score" des actions pour refléter le résultat du moteur
   d’auto‑priorisation. */
.score-badge{
  display:inline-block;
  min-width:2rem;
  padding:0.2rem 0.4rem;
  border-radius:0.5rem;
  background:var(--btn);
  color:var(--text);
  font-weight:bold;
  text-align:center;
  font-size:0.8rem;
  line-height:1;
}

/* Loading overlay and spinner for perceived performance */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
}
.loading-overlay[hidden] {
  display: none;
}
.spinner {
  width: 48px;
  height: 48px;
  border: 5px solid var(--accent);
  border-top-color: transparent;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Responsive design enhancements */
@media (max-width: 600px) {
  .nav { flex-direction: column; }
  .nav-btn { width: 100%; text-align: left; }
  .cards { grid-template-columns: repeat(2, minmax(0, 1fr)); }
  /* Transform tables into block layout on small screens */
  .table thead { display: none; }
  .table, .table tbody, .table tr, .table td { display: block; width: 100%; }
  .table tr { margin-bottom: 10px; border-bottom: 1px solid var(--line); }
  .table td { display: flex; justify-content: space-between; padding: 8px; }
}

@media print{
  header, .nav, .footer, .list-header, .form, #view-dashboard, #view-globals, #view-systems, #view-projects, #view-actions, #view-views, #view-params { display:none !important; }
  #reportView{ display:block !important; }
  body{ background:white; color:black; }
  .report{ background:white; border:none; }
  .table{ background:white; color:black; }
}

/* ===================================================== */
/* Options avancées pour formulaires
   Les sections avancées sont masquées par défaut via l'attribut hidden.
   Les boutons .toggle-advanced permettent de les afficher/replier. */
.advanced-options[hidden] {
  display: none !important;
}
.toggle-advanced {
  margin: 0.5em 0;
  padding: 0.25em 0.6em;
  font-size: 0.88rem;
  border-radius: 4px;
  cursor: pointer;
}
.toggle-advanced.secondary {
  background: var(--btn-bg, #1f2937);
  color: var(--btn-text, #a5b4fc);
  border: 1px solid var(--btn-border, #374151);
}

/* Elements with the hidden class are not displayed. Used to hide nav buttons when
   grouping under the Objet menu. */
.hidden {
  display: none !important;
}

/* Boutons de sélection de mode pour les routines (vue quotidienne).
   On force l’affichage en ligne pour éviter qu’ils ne se superposent verticalement,
   et on ajuste la taille et les marges pour qu’ils tiennent dans une seule cellule. */
#tblViewRoutineToday button.mode-btn {
  display: inline-block;
  width: 28px;
  height: 28px;
  padding: 4px;
  margin-right: 4px;
  text-align: center;
}
#tblViewRoutineToday button.mode-btn.active {
  background: var(--accent);
  color: #fff;
}

/* Mise en forme des étapes de gating dans la section Action‑First. Chaque étape
   est affichée verticalement avec un numéro gras à gauche et le libellé
   aligné sur la même ligne. */
.gating-step {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  margin-bottom: 8px;
}
.gating-step .step {
  font-weight: bold;
  margin-right: 4px;
}

/* Styling for the sub-navigation displayed when the Objet tab is active. This
   horizontal menu appears below the main navigation bar and lets the user
   switch between globaux, systèmes, projets, actions et routines. */
.subnav {
  display: flex;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: var(--card);
  border-bottom: 1px solid var(--line);
}
.subnav-btn {
  background: none;
  border: none;
  color: var(--text);
  padding: 0.25rem 0.5rem;
  cursor: pointer;
}
.subnav-btn[aria-pressed="true"] {
  font-weight: bold;
  border-bottom: 2px solid var(--accent);
}
.subnav.hidden {
  display: none;
}
