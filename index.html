<!doctype html>
<html lang="fr" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Mise √† jour version : passage √† v3.5.0 -->
  <!-- Update the page title to reflect the new application version -->
  <title>Klaro ‚Äî Planificateur v3.5.0</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <a class="skip" href="#app">Aller au contenu</a>
  <header class="topbar glass" role="banner">
    <div class="topbar-left">
      <div class="logo-wrap" aria-hidden="true">
        <svg viewBox="0 0 64 64" role="presentation" focusable="false">
          <defs>
            <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#7fb4ff" />
              <stop offset="100%" stop-color="#4cd4a8" />
            </linearGradient>
          </defs>
          <rect x="4" y="12" width="12" height="40" rx="6" fill="url(#logoGrad)" opacity="0.8" />
          <rect x="26" y="20" width="12" height="32" rx="6" fill="url(#logoGrad)" opacity="0.55" />
          <rect x="48" y="8" width="12" height="44" rx="6" fill="url(#logoGrad)" />
          <polyline points="8,30 32,18 56,30" fill="none" stroke="#dff4ff" stroke-width="3" stroke-linecap="round" />
        </svg>
      </div>
      <div class="brand-stack" aria-label="Nom de l'application">
        <span class="brand-title">Klaro</span>
        <span class="brand-version">Planificateur v3.5.0</span>
      </div>
      <span id="statusBadge" class="status-badge offline" role="status" aria-live="polite">
        <span class="dot" aria-hidden="true"></span>
        <span class="status-text">Hors ligne</span>
      </span>
      <button id="btnNotifications" class="notifications" aria-label="Notifications">
        <span class="icon" aria-hidden="true">üîî</span>
        <span class="badge" id="notifCount">0</span>
      </button>
    </div>
    <div class="topbar-right">
      <div class="nav-stack">
        <nav class="nav primary-nav" aria-label="Navigation principale">
          <button data-nav="dashboard" class="nav-btn active" aria-pressed="true">Dashboard</button>
          <button data-nav="objects" class="nav-btn">Objet</button>
          <button data-nav="globals" class="nav-btn hidden">Obj. Globaux</button>
          <button data-nav="systems" class="nav-btn hidden">Obj. Syst√®me</button>
          <button data-nav="projects" class="nav-btn hidden">Projets</button>
          <button data-nav="actions" class="nav-btn hidden">Actions</button>
          <button data-nav="routines" class="nav-btn hidden">Routines</button>
          <button data-nav="views" class="nav-btn">Vues</button>
          <button data-nav="review" class="nav-btn">Review</button>
          <button data-nav="archives" class="nav-btn hidden">Archiv√©s</button>
          <button data-nav="params" class="nav-btn hidden">Param√®tres</button>
          <button data-nav="redteam" class="nav-btn hidden">Red‚ÄëTeam</button>
        </nav>
        <div class="nav-drawer" id="navDrawer" aria-live="polite">
          <div id="objectDrawer" class="drawer-panel" data-source="objects" aria-label="Sous-menu Objet">
            <div class="drawer-title">Objectifs</div>
            <div class="drawer-buttons">
              <button data-subview="globals" class="subnav-btn" aria-pressed="false">Globaux</button>
              <button data-subview="systems" class="subnav-btn" aria-pressed="false">Syst√®mes</button>
              <button data-subview="projects" class="subnav-btn" aria-pressed="false">Projets</button>
              <button data-subview="actions" class="subnav-btn" aria-pressed="false">Actions</button>
              <button data-subview="routines" class="subnav-btn" aria-pressed="false">Routines</button>
              <button data-subview="archives" class="subnav-btn" aria-pressed="false">Archiv√©s</button>
            </div>
          </div>
          <div id="reviewDrawer" class="drawer-panel" data-source="review" aria-label="Sous-menu Review">
            <div class="drawer-title">Review</div>
            <div class="drawer-buttons">
              <button data-review="redteam" class="subnav-btn" aria-pressed="false">Red‚ÄëTeam</button>
            </div>
          </div>
        </div>
      </div>
      <div class="toolbar">
        <button id="btnTheme" title="Basculer th√®me">üåì</button>
        <button id="btnPrivacy" title="Mode confidentialit√© (masquer noms/‚Ç¨)">üôà</button>
        <button id="btnSettings" title="Param√®tres">‚öôÔ∏è</button>
      </div>
    </div>
  </header>

  <main id="app" role="main">

    <!-- DASHBOARD -->
    <section id="view-dashboard" class="view show" aria-labelledby="h-dashboard">
      <h1 id="h-dashboard">Dashboard</h1>
      <!-- Barre de filtres globales pour le dashboard (p√©riode, projet, responsable) -->
      <div id="dashFilters" class="dash-filters">
        <div class="filter-grid">
          <div class="filter-field range">
            <div class="field-title">P√©riode</div>
            <div class="range-picker">
              <label class="floating" data-label="D√©but">
                <input type="date" id="filterStart" aria-label="Date de d√©but" />
              </label>
              <span class="range-sep" aria-hidden="true">‚Üí</span>
              <label class="floating" data-label="Fin">
                <input type="date" id="filterEnd" aria-label="Date de fin" />
              </label>
            </div>
            <div class="preset-row" role="list">
              <button class="preset" data-preset="today" role="listitem">Aujourd‚Äôhui</button>
              <button class="preset" data-preset="7d" role="listitem">7¬†jours</button>
              <button class="preset" data-preset="30d" role="listitem">30¬†jours</button>
              <button class="preset" data-preset="all" role="listitem">Tout</button>
            </div>
          </div>
          <label class="filter-field floating" data-label="Projet">
            <select id="filterProject" aria-label="Filtrer par projet"><option value="all">Tous</option></select>
          </label>
          <label class="filter-field floating" data-label="Responsable">
            <select id="filterOwner" aria-label="Filtrer par responsable"><option value="all">Tous</option></select>
          </label>
        </div>
        <div class="filter-meta">
          <div id="filterChips" class="filter-chips" aria-live="polite"></div>
          <div class="filter-actions">
            <button id="btnApplyFilters" class="primary" title="Appliquer les filtres">Appliquer</button>
            <button id="btnResetFilters" class="ghost" title="R√©initialiser les filtres">R√©initialiser</button>
            <button id="btnSaveDashboardView" class="ghost" title="Enregistrer la vue">Enregistrer la vue</button>
            <button id="btnDownloadReport" class="ghost" title="T√©l√©charger le rapport complet">T√©l√©charger rapport</button>
          </div>
        </div>
      </div>
      <section class="kpi-area" aria-label="Indicateurs cl√©s">
        <div class="kpi-hero">
          <article class="card hero" data-kpi="global-count">
            <header>
              <span class="kpi-label">Objectifs globaux</span>
              <button class="info" data-tooltip="Nombre total d‚Äôobjectifs strat√©giques actifs.">i</button>
            </header>
            <div class="kpi-value" id="kpiGlobalCount">‚Äî</div>
            <footer id="kpiGlobalTrend" class="kpi-trend" aria-live="polite"></footer>
          </article>
          <article class="card hero" data-kpi="projects-progress">
            <header>
              <span class="kpi-label">Avancement projets</span>
              <button class="info" data-tooltip="Progression moyenne pond√©r√©e sur tous les projets actifs.">i</button>
            </header>
            <div class="kpi-value" id="kpiProjAvg">‚Äî</div>
            <footer id="kpiProjTrend" class="kpi-trend" aria-live="polite"></footer>
          </article>
        </div>
        <div class="kpi-secondary">
          <article class="card secondary">
            <header><span class="kpi-label">Obj. Syst√®me</span><button class="info" data-tooltip="Nombre d‚Äôobjectifs syst√®mes associ√©s aux objectifs globaux.">i</button></header>
            <div class="kpi-value" id="kpiSysCount">‚Äî</div>
          </article>
          <article class="card secondary">
            <header><span class="kpi-label">Avancement ‚Äî Syst√®me</span><button class="info" data-tooltip="Progression moyenne des objectifs syst√®mes.">i</button></header>
            <div class="kpi-value" id="kpiSysAvg">‚Äî</div>
          </article>
          <article class="card secondary">
            <header><span class="kpi-label">Projets</span><button class="info" data-tooltip="Nombre de projets ouverts.">i</button></header>
            <div class="kpi-value" id="kpiProjCount">‚Äî</div>
          </article>
          <article class="card secondary">
            <header><span class="kpi-label">Avancement ‚Äî Globaux</span><button class="info" data-tooltip="Progression moyenne des objectifs globaux.">i</button></header>
            <div class="kpi-value" id="kpiGlobalAvg">‚Äî</div>
          </article>
          <article class="card secondary">
            <header><span class="kpi-label">Actions ouvertes</span><button class="info" data-tooltip="Total des actions actives non termin√©es.">i</button></header>
            <div class="kpi-value" id="kpiActionOpen">‚Äî</div>
          </article>
          <article class="card secondary">
            <header><span class="kpi-label">Actions en retard</span><button class="info" data-tooltip="Actions d√©passant la date d‚Äô√©ch√©ance.">i</button></header>
            <div class="kpi-value" id="kpiActionLate">‚Äî</div>
          </article>
          <article class="card secondary">
            <header><span class="kpi-label">Routines actives</span><button class="info" data-tooltip="Nombre de routines actives programm√©es.">i</button></header>
            <div class="kpi-value" id="kpiRoutineCount">‚Äî</div>
          </article>
          <article class="card secondary">
            <header><span class="kpi-label">T√¢ches routines aujourd‚Äôhui</span><button class="info" data-tooltip="Volume de t√¢ches planifi√©es pour aujourd‚Äôhui dans les routines.">i</button></header>
            <div class="kpi-value" id="kpiRoutineTasksToday">‚Äî</div>
          </article>
          <article class="card secondary">
            <header><span class="kpi-label">Red‚ÄëTeam en attente</span><button class="info" data-tooltip="√âl√©ments Red‚ÄëTeam √† instruire.">i</button></header>
            <div class="kpi-value" id="kpiRedTeamPending">‚Äî</div>
          </article>
        </div>
        <aside class="card alert" aria-live="polite">
          <header>
            <span class="kpi-label">Alertes</span>
            <button class="info" data-tooltip="Projets et actions critiques n√©cessitant une attention imm√©diate.">i</button>
          </header>
          <div class="kpi-value" id="kpiAlerts">‚Äî</div>
        </aside>
      </section>

      <div class="grid grid-2">
        <div class="panel">
        <h2>R√©partition Statuts (Projets) <button class="collapse-btn" aria-label="R√©duire ou √©tendre">‚ñæ</button></h2>
          <div id="statusDist" class="grid grid-2"></div>
          <canvas id="chartStatusDonut" width="320" height="180" aria-label="Statuts projets (graphique)"></canvas>
        </div>
        <div class="panel">
        <h2>V√©locit√© (points faits) <button class="collapse-btn" aria-label="R√©duire ou √©tendre">‚ñæ</button></h2>
          <div class="grid grid-2">
            <div><div class="kpi-label">7 derniers jours</div><div class="kpi-value" id="kpiVelo7">‚Äî</div></div>
            <div><div class="kpi-label">28 derniers jours</div><div class="kpi-value" id="kpiVelo28">‚Äî</div></div>
          </div>
          <canvas id="chartVelo" width="320" height="120" aria-label="V√©locit√© (sparkline)"></canvas>
        </div>
      </div>

      <!-- Panel for upcoming actions (due soon) -->
      <div class="panel">
        <h2>Actions √† venir (7¬†jours) <button class="collapse-btn" aria-label="R√©duire ou √©tendre">‚ñæ</button></h2>
        <table class="table compact" id="tblDashboardDueSoon">
          <thead>
            <tr><th>Projet</th><th>T√¢che</th><th>√âch√©ance</th><th>Resp.</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- R√©partition des statuts pour les actions -->
      <div class="panel">
        <h2>R√©partition Statuts (Actions) <button class="collapse-btn" aria-label="R√©duire ou √©tendre">‚ñæ</button></h2>
        <div id="actionsStatusDist" class="grid grid-2"></div>
        <canvas id="chartActionStatusDonut" width="320" height="180" aria-label="Statuts actions (graphique)"></canvas>
      </div>

      <!-- Actions ouvertes par collaborateur -->
      <div class="panel">
        <h2>Actions par collaborateur <button class="collapse-btn" aria-label="R√©duire ou √©tendre">‚ñæ</button></h2>
        <canvas id="chartActionsOwnerBars" width="480" height="180" aria-label="Actions par collaborateur"></canvas>
        <table class="table compact" id="tblActionsOwner">
          <thead><tr><th>Collaborateur</th><th>Actions ouvertes</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="panel">
        <h2>Charge vs Capacit√© ‚Äî 7¬†prochains jours <button class="collapse-btn" aria-label="R√©duire ou √©tendre">‚ñæ</button></h2>
        <canvas id="chartCapacityBars" width="480" height="180" aria-label="Charge vs capacit√©"></canvas>
        <table class="table compact" id="tblCapacity">
          <thead><tr><th>Collaborateur</th><th>Charge (pts)</th><th>Capacit√© (pts)</th><th>√âcart</th><th>Surcharge ?</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- R√©partition des routines par fr√©quence -->
      <div class="panel">
        <h2>R√©partition Fr√©quence (Routines) <button class="collapse-btn" aria-label="R√©duire ou √©tendre">‚ñæ</button></h2>
        <div id="routineFreqDist" class="grid grid-2"></div>
        <canvas id="chartRoutineFreqDonut" width="320" height="180" aria-label="Fr√©quence routines (graphique)"></canvas>
      </div>

      <div class="panel">
        <h2>Gantt (8¬†semaines) <button class="collapse-btn" aria-label="R√©duire ou √©tendre">‚ñæ</button></h2>
        <div id="dashGantt" class="gantt"></div>
      </div>
    </section>

    <!-- ROUTINES (p√©riodiques) -->
    <section id="view-routines" class="view" aria-labelledby="h-routines">
      <div class="list-header">
        <h1 id="h-routines">Routines</h1>
        <div class="right">
          <input id="searchRoutines" class="searchbox" type="search" placeholder="Rechercher‚Ä¶" aria-label="Rechercher routines">
          <button id="btnAddRoutine">‚ûï Ajouter</button>
        </div>
      </div>

      <div class="filterbar" id="fb-routines" hidden>
        <!-- reserved for future filters -->
      </div>

      <form id="formRoutine" class="form collapsed" aria-label="Formulaire Routine">
        <h3 id="titleRoutineForm">Nouvelle routine</h3>
        <div class="grid grid-3">
          <label>Nom<input name="name" required /></label>
          <label>Syst√®me<select name="idSystem"></select></label>
          <label>Fr√©quence<select name="frequency">
            <option value="daily">Quotidien</option>
            <option value="weekly">Hebdomadaire</option>
            <option value="monthly">Mensuel</option>
          </select></label>
          <label class="routine-weekly">Jours (hebdo)
            <div class="chips days-select">
              <label><input type="checkbox" name="dow" value="0">Dim</label>
              <label><input type="checkbox" name="dow" value="1">Lun</label>
              <label><input type="checkbox" name="dow" value="2">Mar</label>
              <label><input type="checkbox" name="dow" value="3">Mer</label>
              <label><input type="checkbox" name="dow" value="4">Jeu</label>
              <label><input type="checkbox" name="dow" value="5">Ven</label>
              <label><input type="checkbox" name="dow" value="6">Sam</label>
            </div>
          </label>
          <label class="routine-monthly">Jour du mois<input type="number" name="dom" min="1" max="31" /></label>
          <label><input type="checkbox" name="autoCreate" /> Cr√©er automatiquement pour aujourd‚Äôhui</label>
        </div>
        <fieldset class="objective-editor" data-target="routineObjectives">
          <legend>üéØ Objectifs de la routine</legend>
          <p id="routineObjectivesHint" class="muted">Pr√©cisez les attentes de la routine. Ajoutez au minimum trois objectifs couvrant le temps, le r√©sultat et la m√©thode.</p>
          <div id="routineObjectives" class="objective-items" role="list"></div>
          <button type="button" class="secondary" data-add-objective="routineObjectives">‚ûï Ajouter un objectif</button>
        </fieldset>
        <h4>T√¢ches de la routine</h4>
        <div class="table-wrapper">
          <!-- La table des t√¢ches permet d√©sormais de sp√©cifier un mode (court, normal, long) par t√¢che -->
          <table class="table compact" id="tblRoutineTasks">
            <thead>
              <tr>
                <th>Titre</th>
                <th>Dur√©e (min)</th>
                <th>Mode</th>
                <th>Moment</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="form-actions">
          <button type="button" id="btnAddRoutineTask">‚ûï Ajouter t√¢che</button>
          <button type="submit">üíæ Enregistrer</button>
          <button type="button" class="secondary" id="cancelRoutine">Annuler</button>
        </div>
      </form>

      <table class="table" id="tblRoutines">
        <thead>
          <tr>
            <!-- Colonne ID masqu√©e via classe col-id -->
            <th data-sort="id" data-type="text" class="col-id">ID</th>
            <th data-sort="idSystem" data-type="text">Syst√®me</th>
            <th data-sort="name" data-type="text">Nom</th>
            <th data-sort="frequency" data-type="text">Fr√©quence</th>
            <th data-sort="active" data-type="text">Actif</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- GLOBALS -->
    <section id="view-globals" class="view" aria-labelledby="h-globals">
      <div class="list-header">
        <h1 id="h-globals">Objectifs globaux</h1>
        <div class="right">
          <input id="searchGlobals" class="searchbox" type="search" placeholder="Rechercher‚Ä¶" aria-label="Rechercher objectifs globaux">
          <button id="btnAddGlobal">‚ûï Ajouter</button>
        </div>
      </div>

      <div class="filterbar" id="fb-globals">
        <div class="chips" id="chips-globals" aria-live="polite"></div>
        <div class="filters-row">
          <label>Champ <select id="f-field-globals"></select></label>
          <label>Op√©rateur <select id="f-op-globals"></select></label>
          <label>Valeur <input id="f-value-globals" /></label>
          <button id="f-add-globals">Ajouter filtre</button>
          <button class="secondary" id="f-clear-globals">Effacer</button>
        </div>
        <div class="sort-row">
          <label>Trier par <select id="sort-globals"></select></label>
        </div>
      </div>

      <form id="formGlobal" class="form collapsed" aria-label="Formulaire Objectif global">
        <h3 id="titleGlobalForm">Nouvel objectif global</h3>
        <!-- Bouton pour afficher/masquer les options avanc√©es -->
        <button type="button" class="toggle-advanced secondary" aria-expanded="false" aria-controls="advGlobalFields">+ Options avanc√©es</button>
        <!-- Champs essentiels pour un objectif global -->
        <div class="grid grid-3">
          <label>Intitul√©<input name="title" required /></label>
          <label>Domaine<select name="domain"></select></label>
          <label>Horizon (ans)<input type="number" step="1" name="horizonYears" value="1" /></label>
        </div>
        <!-- Options avanc√©es masqu√©es par d√©faut -->
        <div id="advGlobalFields" class="grid grid-3 advanced-options" hidden>
          <label>KPI principal<input name="kpi" /></label>
          <label>Baseline<input type="number" step="any" name="baseline" value="0" /></label>
          <label>Cible<input type="number" step="any" name="target" value="100" /></label>
          <label>Unit√©<select name="unit"></select></label>
          <label>Valeur actuelle<input type="number" step="any" name="currentValue" value="0" /></label>
          <label>Responsable<select name="owner"></select></label>
          <label>Statut<select name="status"></select></label>
          <label>Priorit√©<select name="priority"></select></label>
          <label>Risque (1‚Äì5)<input type="number" step="1" min="1" max="5" name="risk" value="3" /></label>
          <label>Clart√© (1‚Äì5)<input type="number" step="1" min="1" max="5" name="clarity" value="3" /></label>
          <label>Impact (1‚Äì5)<input type="number" step="1" min="1" max="5" name="impact" value="3" /></label>
          <label>Urgence (1‚Äì5)<input type="number" step="1" min="1" max="5" name="urgency" value="3" /></label>
          <label>Date d√©but<input type="date" name="startDate" /></label>
          <label>Date fin cible<input type="date" name="targetDate" /><span class="no-date-wrapper"><input type="checkbox" class="no-end-date" data-target="targetDate" /> Sans date de fin</span></label>
          <label>Description<textarea name="description" rows="2"></textarea></label>
        </div>
        <div class="form-actions">
          <button type="submit">üíæ Enregistrer</button>
          <button type="button" class="secondary" id="cancelGlobal">Annuler</button>
        </div>
      </form>

      <table class="table" id="tblGlobals">
        <thead>
          <tr>
            <th data-sort="id" data-type="text" class="col-id">ID</th>
            <th data-sort="title" data-type="text">Intitul√©</th>
            <th data-sort="domain" data-type="text">Domaine</th>
            <th data-sort="progressValue" data-type="percent">% Avancement</th>
            <th data-sort="avgSystems" data-type="percent">Avancement (syst√®mes)</th>
            <th data-sort="avgProjects" data-type="percent">Avancement (projets)</th>
            <th data-sort="owner" data-type="text">Propri√©taire</th>
            <th data-sort="priority" data-type="text">Priorit√©</th>
            <th data-sort="status" data-type="text">Statut</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- SYSTEMS -->
    <section id="view-systems" class="view" aria-labelledby="h-systems">
      <div class="list-header">
        <h1 id="h-systems">Objectifs syst√®me</h1>
        <div class="right">
          <input id="searchSystems" class="searchbox" type="search" placeholder="Rechercher‚Ä¶" aria-label="Rechercher objectifs syst√®me">
          <button id="btnAddSystem">‚ûï Ajouter</button>
        </div>
      </div>

      <div class="filterbar" id="fb-systems">
        <div class="chips" id="chips-systems" aria-live="polite"></div>
        <div class="filters-row">
          <label>Champ <select id="f-field-systems"></select></label>
          <label>Op√©rateur <select id="f-op-systems"></select></label>
          <label>Valeur <input id="f-value-systems" /></label>
          <button id="f-add-systems">Ajouter filtre</button>
          <button class="secondary" id="f-clear-systems">Effacer</button>
        </div>
        <div class="sort-row">
          <label>Trier par <select id="sort-systems"></select></label>
        </div>
      </div>

      <form id="formSystem" class="form collapsed" aria-label="Formulaire Objectif syst√®me">
        <h3 id="titleSystemForm">Nouvel objectif syst√®me</h3>
        <!-- Bouton Options avanc√©es -->
        <button type="button" class="toggle-advanced secondary" aria-expanded="false" aria-controls="advSystemFields">+ Options avanc√©es</button>
        <!-- Champs essentiels -->
        <div class="grid grid-3">
          <label>Objectif global<select name="idGlobal"></select></label>
          <label>Intitul√©<input name="title" required /></label>
        </div>
        <!-- Champs avanc√©s -->
        <div id="advSystemFields" class="grid grid-3 advanced-options" hidden>
          <label>KPI principal<input name="kpi" /></label>
          <label>Baseline<input type="number" step="any" name="baseline" value="0" /></label>
          <label>Cible<input type="number" step="any" name="target" value="100" /></label>
          <label>Unit√©<select name="unit"></select></label>
          <label>Actuel<input type="number" step="any" name="current" value="0" /></label>
          <label>Responsable<select name="owner"></select></label>
          <label>Statut<select name="status"></select></label>
          <label>Priorit√©<select name="priority"></select></label>
          <label>Date d√©but<input type="date" name="startDate" /></label>
          <label>Date fin cible<input type="date" name="targetDate" /><span class="no-date-wrapper"><input type="checkbox" class="no-end-date" data-target="targetDate" /> Sans date de fin</span></label>
          <label>Description<textarea name="description" rows="2"></textarea></label>
        </div>
        <fieldset class="objective-editor" data-target="systemObjectives">
          <legend>üéØ Objectifs du syst√®me</legend>
          <p id="systemObjectivesHint" class="muted">D√©finissez au minimum trois objectifs dont un temporel, un sur le r√©sultat et un sur la mani√®re de faire.</p>
          <div id="systemObjectives" class="objective-items" role="list"></div>
          <button type="button" class="secondary" data-add-objective="systemObjectives">‚ûï Ajouter un objectif</button>
        </fieldset>
        <div class="form-actions">
          <button type="submit">üíæ Enregistrer</button>
          <button type="button" class="secondary" id="cancelSystem">Annuler</button>
        </div>
      </form>

      <table class="table" id="tblSystems">
        <thead>
          <tr>
            <th data-sort="id" data-type="text" class="col-id">ID</th>
            <th data-sort="idGlobal" data-type="text">Global</th>
            <th data-sort="title" data-type="text">Intitul√©</th>
            <th data-sort="progress" data-type="percent">% Avancement</th>
            <th data-sort="owner" data-type="text">Responsable</th>
            <th data-sort="priority" data-type="text">Priorit√©</th>
            <th data-sort="status" data-type="text">Statut</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- PROJECTS -->
    <section id="view-projects" class="view" aria-labelledby="h-projects">
      <div class="list-header">
        <h1 id="h-projects">Projets</h1>
        <div class="right">
          <input id="searchProjects" class="searchbox" type="search" placeholder="Rechercher‚Ä¶" aria-label="Rechercher projets">
          <button id="btnAddProject">‚ûï Ajouter</button>
        </div>
      </div>

      <div class="filterbar" id="fb-projects">
        <div class="chips" id="chips-projects" aria-live="polite"></div>
        <div class="filters-row">
          <label>Champ <select id="f-field-projects"></select></label>
          <label>Op√©rateur <select id="f-op-projects"></select></label>
          <label>Valeur <input id="f-value-projects" /></label>
          <button id="f-add-projects">Ajouter filtre</button>
          <button class="secondary" id="f-clear-projects">Effacer</button>
        </div>
        <div class="sort-row">
          <label>Trier par <select id="sort-projects"></select></label>
        </div>
        <div class="hierarchy-toolbar" role="group" aria-label="Navigation hi√©rarchique des projets">
          <label>Explorer
            <select id="projectHierarchySelect" aria-label="Explorer un n≈ìud hi√©rarchique">
              <option value="__all">Tous les projets</option>
              <option value="__root">Racine (sans parent)</option>
            </select>
          </label>
          <label class="inline"><input type="checkbox" id="projectHierarchyIncludeDesc" checked> Inclure les descendants</label>
          <button type="button" id="projectHierarchyReset" class="secondary" title="Afficher tous les projets">R√©initialiser</button>
        </div>
      </div>

      <div class="bulkbar" id="bulkProjects" hidden>
        <div>√âl√©ments s√©lectionn√©s : <span id="bulkProjCount">0</span></div>
        <div class="actions">
          <button data-bulk="status:Planifi√©">Planifi√©</button>
          <button data-bulk="status:En cours">En cours</button>
          <button data-bulk="status:Bloqu√©">Bloqu√©</button>
          <button data-bulk="status:Termin√©">Termin√©</button>
          <button data-bulk="delete" class="danger">üóëÔ∏è Supprimer</button>
          <button data-bulk="export">‚¨áÔ∏è Exporter CSV</button>
        </div>
      </div>

      <form id="formProject" class="form collapsed" aria-label="Formulaire Projet">
        <h3 id="titleProjectForm">Nouveau projet</h3>
        <!-- Bouton Options avanc√©es -->
        <button type="button" class="toggle-advanced secondary" aria-expanded="false" aria-controls="advProjectFields">+ Options avanc√©es</button>
        <!-- Champs essentiels -->
        <div class="grid grid-3">
          <label>Objectif global<select name="idGlobal"></select></label>
          <label>Objectif syst√®me<select name="idSystem"></select></label>
          <label>Projet / livrable<input name="title" required /></label>
          <label>Mode de suivi<select name="mode"><option value="value">Valeur</option><option value="tasks">T√¢ches</option></select></label>
          <label>Responsable<select name="owner"></select></label>
          <label>Statut<select name="status"></select></label>
          <label>Priorit√©<select name="priority"></select></label>
          <label>Date fin planifi√©e<input type="date" name="plannedEnd" /><span class="no-date-wrapper"><input type="checkbox" class="no-end-date" data-target="plannedEnd" /> Sans date de fin</span></label>
        </div>
        <!-- Champs avanc√©s -->
        <div id="advProjectFields" class="grid grid-3 advanced-options" hidden>
          <label>Hypoth√®se test√©e<input name="hypothesis" /></label>
          <label>Indicateur principal<input name="indicator" /></label>
          <label>Cible<input type="number" step="any" name="target" value="100" /></label>
          <label>Unit√©<select name="unit"></select></label>
          <label>Valeur actuelle<input type="number" step="any" name="current" value="0" /></label>
          <label>Budget (‚Ç¨)<input type="number" step="any" name="budget" value="0" /></label>
          <label>Co√ªt r√©el (‚Ç¨)<input type="number" step="any" name="actualCost" value="0" /></label>
          <label>Revenus (‚Ç¨)<input type="number" step="any" name="revenue" value="0" /></label>
          <label>Impact (1‚Äì5)<input type="number" step="1" min="1" max="5" name="impact" value="3" /></label>
          <label>Confiance (0‚Äì1)<input type="number" step="0.1" min="0" max="1" name="confidence" value="0.7" /></label>
          <label>Effort (jours)<input type="number" step="1" min="0" name="effort" value="5" /></label>
          <label>Risque (1‚Äì5)<input type="number" step="1" min="1" max="5" name="risk" value="3" /></label>
          <label>√ânergie (1‚Äì10)<input type="number" step="1" min="1" max="10" name="energy" value="10" /></label>
          <label>Contribution au but ma√Ætre (0‚Äì100%)<input type="number" step="1" min="0" max="100" name="contribution" value="80" /></label>
          <label>√âtat d‚Äô√©nergie<select name="energyState"><option value="vivant">Vivant</option><option value="stagnant">Stagnant</option></select></label>
          <label>Risque dilution<select name="dilutionRisk">
            <option value="">‚Äî</option>
            <option value="temps">Temps</option>
            <option value="contexte">Contexte</option>
            <option value="attention">Attention</option>
          </select></label>
          <!-- Niveau actuel du projet : En cours ou Autonome -->
          <label>Niveau actuel<select name="currentLevel">
            <option value="">‚Äî</option>
            <option value="running">En cours</option>
            <option value="automatic">Automatique</option>
          </select></label>
          <!-- Masse critique : pourcentage √† partir duquel le projet est consid√©r√© accompli -->
          <label>Masse critique (%)<input type="number" step="1" min="1" max="100" name="criticalMass" value="80" /></label>
          <label>Date d√©but<input type="date" name="startDate" /></label>
          <label>Date fin r√©elle<input type="date" name="actualEnd" /><span class="no-date-wrapper"><input type="checkbox" class="no-end-date" data-target="actualEnd" /> Sans date de fin</span></label>
          <label>Commentaires<textarea name="comments" rows="2"></textarea></label>
          <label>√âtapes d‚Äôescalade<textarea name="escalation" rows="2" placeholder="Listez les √©tapes (une par ligne)"></textarea></label>
          <label>Projets parents<select name="parentProjects" multiple size="4"></select><span class="field-hint">S√©lectionnez les projets englobants pour cr√©er des syst√®mes multi-niveaux.</span></label>
        </div>
        <fieldset class="objective-editor" data-target="projectObjectives">
          <legend>üéØ Objectifs du projet</legend>
          <p id="projectObjectivesHint" class="muted">Ajoutez au minimum trois objectifs couvrant le temps, le r√©sultat et la m√©thode pour cadrer le projet.</p>
          <div id="projectObjectives" class="objective-items" role="list"></div>
          <button type="button" class="secondary" data-add-objective="projectObjectives">‚ûï Ajouter un objectif</button>
        </fieldset>
        <div class="form-actions">
          <button type="submit">üíæ Enregistrer</button>
          <button type="button" class="secondary" id="cancelProject">Annuler</button>
        </div>
      </form>

      <table class="table" id="tblProjects">
        <thead>
          <tr>
            <th class="selectcol"><input type="checkbox" id="selAllProjects" aria-label="Tout s√©lectionner"></th>
            <th data-sort="id" data-type="text" class="col-id">ID</th>
            <th data-sort="title" data-type="text">Projet</th>
            <th data-sort="progressOverall" data-type="percent">% Global</th>
            <th data-sort="ICE" data-type="number">ICE</th>
            <th data-sort="SPI" data-type="number">SPI</th>
            <th data-sort="RAG" data-type="text">RAG</th>
            <!-- Colonne √©nergie du projet -->
            <th data-sort="energy" data-type="number">√ânergie</th>
            <!-- Indicateurs Kairos¬†: contribution, √©tat d'√©nergie, risque de dilution -->
            <th data-sort="contribution" data-type="number">Contrib.</th>
            <th data-sort="energyState" data-type="text">√âtat</th>
            <th data-sort="dilutionRisk" data-type="text">Dilution</th>
            <th data-sort="status" data-type="text">Statut</th>
            <th data-sort="plannedEnd" data-type="date">Fin planifi√©e</th>
            <th data-sort="owner" data-type="text">Resp.</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- ACTIONS -->
    <section id="view-actions" class="view" aria-labelledby="h-actions">
      <div class="list-header">
        <h1 id="h-actions">Actions</h1>
        <div class="right">
          <input id="searchActions" class="searchbox" type="search" placeholder="Rechercher‚Ä¶" aria-label="Rechercher actions">
          <button id="btnAddAction">‚ûï Ajouter</button>
        </div>
      </div>

      <div class="filterbar" id="fb-actions">
        <div class="chips" id="chips-actions" aria-live="polite"></div>
        <div class="filters-row">
          <label>Champ <select id="f-field-actions"></select></label>
          <label>Op√©rateur <select id="f-op-actions"></select></label>
          <label>Valeur <input id="f-value-actions" /></label>
          <button id="f-add-actions">Ajouter filtre</button>
          <button class="secondary" id="f-clear-actions">Effacer</button>
        </div>
        <div class="sort-row">
          <label>Trier par <select id="sort-actions"></select></label>
        </div>
      </div>

      <div class="bulkbar" id="bulkActions" hidden>
        <div>√âl√©ments s√©lectionn√©s : <span id="bulkActCount">0</span></div>
        <div class="actions">
          <button data-bulk-act="status:√Ä faire">√Ä faire</button>
          <button data-bulk-act="status:En cours">En cours</button>
          <button data-bulk-act="status:Bloqu√©">Bloqu√©</button>
          <button data-bulk-act="status:Fait">Fait</button>
          <button data-bulk-act="delete" class="danger">üóëÔ∏è Supprimer</button>
          <button data-bulk-act="export">‚¨áÔ∏è Exporter CSV</button>
        </div>
      </div>

      <!-- Barre d‚Äôauto‚Äëpriorisation : permet de saisir le niveau d‚Äô√©nergie de l‚Äôutilisateur
           et de d√©clencher le calcul automatique des priorit√©s pour les actions. -->
      <div class="auto-prio-bar" style="margin: 0.5rem 0; display:flex; flex-wrap:wrap; gap:1rem; align-items:center;">
        <label style="display:flex; align-items:center; gap:0.25rem;">
          √ânergie actuelle
          <input id="userEnergyNow" type="number" min="1" max="10" value="8" style="width:4rem;" aria-label="√ânergie actuelle (1 √† 10)">
        </label>
        <button id="btnAutoPrioritize" type="button" title="Calcule un ordre d‚Äôex√©cution optimal des t√¢ches selon l‚Äôimpact, l‚Äôurgence, l‚Äôeffort et l‚Äôalignement √©nerg√©tique">‚ö° Auto‚ÄëPrioriser maintenant</button>
        <small style="flex:1 1 100%; font-size:0.8rem;">Score = 40% impact + 25% urgence + 20% (1 - effort) + 15% alignement √©nergie</small>
      </div>

      <form id="formAction" class="form collapsed" aria-label="Formulaire Action">
        <h3 id="titleActionForm">Nouvelle action</h3>
        <!-- Bouton Options avanc√©es -->
        <button type="button" class="toggle-advanced secondary" aria-expanded="false" aria-controls="advActionFields">+ Options avanc√©es</button>
        <!-- Champs essentiels -->
        <div class="grid grid-3">
          <label>Projet<select name="idProject"></select></label>
          <label>T√¢che<input name="task" required /></label>
          <label>Responsable<select name="owner"></select></label>
          <label>Date fin pr√©vue<input type="date" name="dueDate" /><span class="no-date-wrapper"><input type="checkbox" class="no-end-date" data-target="dueDate" /> Sans date de fin</span></label>
          <label>Points<input type="number" step="1" min="0" name="points" value="1" /></label>
          <label>Statut<select name="statusTask"></select></label>
          <!-- Moment de la journ√©e : permet de planifier l‚Äôaction (Matin, Aprem, Soir) -->
          <label>Moment<select name="timeOfDay">
            <option value="">‚Äî</option>
            <option value="morning">Matin</option>
            <option value="afternoon">Aprem</option>
            <option value="evening">Soir</option>
          </select></label>
        </div>
        <fieldset class="objective-editor" data-target="actionObjectives">
          <legend>üéØ Objectifs de l‚Äôaction</legend>
          <p id="actionObjectivesHint" class="muted">Minimum requis¬†: un objectif temporel, un objectif de r√©sultat et un objectif sur la mani√®re de faire. Ajoutez-en autant que n√©cessaire.</p>
          <div id="actionObjectives" class="objective-items" role="list"></div>
          <button type="button" class="secondary" data-add-objective="actionObjectives">‚ûï Ajouter un objectif</button>
        </fieldset>
        <!-- Champs avanc√©s -->
        <div id="advActionFields" class="grid grid-3 advanced-options" hidden>
          <label>Date d√©but<input type="date" name="startDate" /></label>
          <label>Date fin r√©elle<input type="date" name="doneDate" /><span class="no-date-wrapper"><input type="checkbox" class="no-end-date" data-target="doneDate" /> Sans date de fin</span></label>
          <label>Dur√©e estim√©e (h)<input type="number" step="1" min="0" name="estHours" value="1" /></label>
          <label>Dur√©e r√©elle (h)<input type="number" step="1" min="0" name="realHours" value="0" /></label>
          <!-- Indicateurs pour l‚Äôauto‚Äëpriorisation -->
          <label>Impact (1‚Äì10)<input type="number" min="1" max="10" name="impact" value="5" /></label>
          <label>Urgence (1‚Äì10)<input type="number" min="1" max="10" name="urgency" value="5" /></label>
          <label>Effort estim√© (1‚Äì10)<input type="number" min="1" max="10" name="effort_estimate" value="5" /></label>
          <label>√ânergie requise (1‚Äì10)<input type="number" min="1" max="10" name="energy_required" value="5" /></label>
          <label>Tag<input name="tag" /></label>
          <label>Commentaires<textarea name="comments" rows="2"></textarea></label>
          <!-- Sous-objectifs SMART : un par ligne, doit contenir lettres et chiffres -->
          <label>Sous-objectifs SMART<textarea name="subgoals" rows="2" placeholder="Un sous‚Äëobjectif par ligne (lettres et chiffres)"></textarea></label>
        </div>
        <div class="form-actions">
          <button type="submit">üíæ Enregistrer</button>
          <button type="button" class="secondary" id="cancelAction">Annuler</button>
        </div>
      </form>

      <table class="table" id="tblActions">
        <thead>
          <tr>
            <th class="selectcol"><input type="checkbox" id="selAllActions" aria-label="Tout s√©lectionner"></th>
            <th data-sort="id" data-type="text" class="col-id">ID</th>
            <th data-sort="idProject" data-type="text">Projet</th>
            <th data-sort="task" data-type="text">T√¢che</th>
            <th data-sort="dueDate" data-type="date">Due</th>
            <th data-sort="points" data-type="number">Points</th>
            <th data-sort="statusTask" data-type="text">Statut</th>
            <th data-sort="owner" data-type="text">Resp.</th>
            <th data-sort="score" data-type="number">Score</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- VIEWS -->
    <section id="view-views" class="view" aria-labelledby="h-views">
      <h1 id="h-views">Vues</h1>
      <div class="view-mode-select">
        <span>S√©lection mode routine:</span>
        <label><input type="radio" name="viewMode" value="short" checked /> Court</label>
        <label><input type="radio" name="viewMode" value="normal" /> Normal</label>
        <label><input type="radio" name="viewMode" value="long" /> Long</label>
      </div>
              <!-- ACTION-FIRST ‚Äî Diagnostic & Pack -->
        <div class="panel" id="afPanel">
          <h3>üéØ Action-First (diagnostic & pack)</h3>

          <!-- Gating (G0‚ÜíG3) -->
          <form id="afGating" class="form" aria-label="Gating Action-First">
            <!-- √âtapes de gating dispos√©es verticalement sans cases √† cocher, selon l‚Äôexemple fourni -->
            <div class="gating-step">
              <span class="step">2.</span>
              <span>2‚Äì3¬†testeurs/sources¬†?</span>
            </div>
            <div class="gating-step">
              <span class="step">3.</span>
              <span>Question binaire + m√©triques¬†?</span>
            </div>
            <div class="gating-step">
              <span class="step">4.</span>
              <span>Contrainte prouv√©e¬†? (gardien / ressource / date)</span>
              <input name="g3_proof" placeholder="Ex¬†: Admin WhatsApp / acc√®s groupe / 2025-11-07">
            </div>
            <div class="gating-step">
              <span class="step">5.</span>
              <span>Projet cible (optionnel)</span>
              <select id="afProject"></select>
            </div>
            <div class="form-actions">
              <button type="button" id="afRunGating">√âtape suivante</button>
            </div>
          </form>

          <!-- Matrice Oui/Non -->
          <details id="afMatrixBox" open>
            <summary>üßÆ Matrice Oui/Non</summary>
            <div class="grid grid-3" id="afMatrix"></div>
            <div class="form-actions">
              <button type="button" id="afDetect">D√©tecter le type</button>
              <span id="afTypeBadge" class="chip" aria-live="polite"></span>
            </div>
          </details>

          <!-- Pack d'hypoth√®ses H1‚ÜíHn rendu ici -->
          <div id="afPack"></div>
        </div>
      <div class="grid grid-2">
        <div class="panel">
          <h3>‚è±Ô∏è Projets en retard</h3>
          <table class="table" id="tblViewLate">
            <thead><tr><th>ID</th><th>Projet</th><th>D√©but</th><th>Fin planifi√©e</th><th>√âcart</th><th>ICE</th><th>Priorit√©</th><th>Resp.</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="panel">
          <h3>üß± Projets bloqu√©s</h3>
          <table class="table" id="tblViewBlocked">
            <thead><tr><th>ID</th><th>Projet</th><th>Avancement</th><th>ICE</th><th>Priorit√©</th><th>Resp.</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div class="panel">
        <h3>‚è∞ Actions bient√¥t dues</h3>
        <table class="table" id="tblViewDueSoon">
          <thead><tr><th>ID</th><th>Projet</th><th>T√¢che</th><th>Due</th><th>Jours restants</th><th>Resp.</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Routine & Actions du jour -->
      <div class="grid grid-2">
        <div class="panel">
          <h3>üîÅ Routines ‚Äì aujourd'hui</h3>
          <table class="table" id="tblViewRoutineToday">
            <thead><tr><th>ID</th><th>Routine</th><th>T√¢che</th><th>Dur√©e</th><th>Mode</th><th>Resp.</th><th>Statut</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="panel">
          <h3>‚úîÔ∏è Actions ‚Äì aujourd'hui / en cours</h3>
          <table class="table" id="tblViewActionToday">
            <thead>
              <tr>
                <th>ID</th>
                <th>Projet</th>
                <th>T√¢che</th>
                <th>Due</th>
                <th>Temps</th>
                <th>Statut</th>
                <th>Resp.</th>
                <th>Finir</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- Liste des t√¢ches faites aujourd'hui -->
      <div class="panel">
        <h3>‚úÖ Actions effectu√©es aujourd'hui</h3>
        <table class="table" id="tblViewActionDone">
          <thead>
            <tr>
              <th>ID</th>
              <th>Projet</th>
              <th>T√¢che</th>
              <th>Due</th>
              <th>Statut</th>
              <th>Resp.</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ARCHIVES -->
    <section id="view-archives" class="view" aria-labelledby="h-archives">
      <h1 id="h-archives">Archiv√©s</h1>
      <div class="grid grid-2">
        <div class="panel">
          <h3>üì¶ Actions archiv√©es</h3>
          <table class="table" id="tblArchivedActions">
            <thead>
              <tr>
                <th class="col-id">ID</th>
                <th>Projet</th>
                <th>T√¢che</th>
                <th>√âch√©ance</th>
                <th>Points</th>
                <th>Statut</th>
                <th>Resp.</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="panel">
          <h3>üì¶ Routines archiv√©es</h3>
          <table class="table" id="tblArchivedRoutines">
            <thead>
              <tr>
                <th class="col-id">ID</th>
                <th>Syst√®me</th>
                <th>Nom</th>
                <th>Fr√©quence</th>
                <th>Actif</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- PARAMS (inclut Donn√©es) -->
    <section id="view-params" class="view" aria-labelledby="h-params">
      <div class="tabs" id="paramsTabs" role="tablist">
        <button id="tab-general" class="tab active" role="tab" data-tab="p-general" aria-controls="p-general" aria-selected="true" tabindex="0">G√©n√©ral</button>
        <button id="tab-data" class="tab" role="tab" data-tab="p-data" aria-controls="p-data" aria-selected="false" tabindex="-1">Donn√©es</button>
        <button id="tab-guide" class="tab" role="tab" data-tab="p-guide" aria-controls="p-guide" aria-selected="false" tabindex="-1">Guide</button>
      </div>

  <!-- Overlay de chargement pour feedback de performance -->
  <!-- supprim√© de cette position pour √™tre rendu global -->

      <div id="p-general" class="tabpanel show" role="tabpanel" aria-labelledby="tab-general" aria-hidden="false" tabindex="-1">
        <h1 id="h-params">Param√®tres</h1>
        <div class="grid grid-2">
          <form id="formThresholds" class="form" aria-label="Seuils">
            <h3>Seuils</h3>
            <div class="grid grid-3">
              <label>Variance rouge (‚â§) <input name="varRed" type="number" step="0.01" value="-0.10" /></label>
              <label>Variance ambre (‚â§) <input name="varAmber" type="number" step="0.01" value="-0.03" /></label>
              <label>‚ÄúDue soon‚Äù (jours) <input name="dueSoonDays" type="number" step="1" value="7" /></label>
              <label>SPI rouge (‚â§) <input name="spiRed" type="number" step="0.01" value="0.90" /></label>
              <label>SPI ambre (‚â§) <input name="spiAmber" type="number" step="0.01" value="0.98" /></label>
            </div>
            <div class="form-actions"><button type="submit">üíæ Enregistrer seuils</button></div>
          </form>

          <form id="formEnums" class="form" aria-label="Listes">
            <h3>Listes</h3>
            <label>Domaines <textarea name="domains" rows="3"></textarea></label>
            <label>Statuts (projets) <textarea name="statuses" rows="3"></textarea></label>
            <label>Priorit√©s <textarea name="priorities" rows="3"></textarea></label>
            <label>Unit√©s <textarea name="units" rows="3"></textarea></label>
            <label>Statuts t√¢ches <textarea name="taskStatuses" rows="3"></textarea></label>
            <label>Collaborateurs <textarea name="collaborators" rows="3"></textarea></label>
            <div class="form-actions"><button type="submit">üíæ Enregistrer listes</button></div>
          </form>

        </div>

        <!-- Panneau de personnalisation pour permettre la modification de la couleur d'accent -->
        <div class="panel">
          <h3>Personnalisation</h3>
          <form id="formAccent" class="form" aria-label="Personnalisation">
            <label>Couleur principale
              <input type="color" id="accentColorPicker" name="accentColor" />
            </label>
            <div class="form-actions"><button type="button" id="btnSaveAccent">üé® Appliquer couleur</button></div>
          </form>
        </div>

        <div class="panel">
          <h3>Capacit√©s (points / semaine)</h3>
          <table class="table compact" id="tblCaps">
            <thead><tr><th>Collaborateur</th><th>Capacit√©</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
          <div class="form-actions">
            <button id="btnAddCap">‚ûï Ajouter Collaborateur</button>
            <button id="btnSaveCaps">üíæ Enregistrer capacit√©s</button>
          </div>
        </div>

        <div class="panel">
          <h3>Templates (actions par d√©faut)</h3>
          <div class="grid grid-2">
            <form id="formTemplate" class="form" aria-label="Cr√©er template">
              <label>Nom du template <input name="tplName" required /></label>
              <label>Actions (une par ligne) <textarea name="tplActions" rows="5" placeholder="Ex: D√©couverte client
R√©diger plan
Maquette V1"></textarea></label>
              <div class="form-actions"><button type="submit">üíæ Enregistrer template</button></div>
            </form>
            <div class="form">
              <label>Appliquer √† un projet (ID) <input id="tplProjectId" /></label>
              <label>Template<select id="tplSelect"></select></label>
              <div class="form-actions"><button id="btnApplyTpl">‚ú® Appliquer</button></div>
            </div>
          </div>
        </div>

      </div>

      <div id="p-data" class="tabpanel" role="tabpanel" aria-labelledby="tab-data" aria-hidden="true" tabindex="-1">
        <h1 id="h-data">Donn√©es</h1>
        <div class="grid grid-2">
          <div class="panel">
            <h3>Exporter</h3>
            <p>Exporte toutes les donn√©es (JSON) pour sauvegarde ou migration.</p>
            <button id="btnExport">‚¨áÔ∏è Exporter JSON</button>
            <button id="btnExportProjectsCSV">‚¨áÔ∏è Exporter Projets (CSV)</button>
            <button id="btnExportActionsCSV">‚¨áÔ∏è Exporter Actions (CSV)</button>
          </div>
          <div class="panel">
            <h3>Importer</h3>
            <p>JSON complet ou CSV cibl√©.</p>
            <input type="file" id="fileImport" accept=".json,application/json,.csv,text/csv" multiple />
            <div class="form-actions">
              <button id="btnImportJSON">‚¨ÜÔ∏è Importer JSON</button>
              <button id="btnImportProjectsCSV">‚¨ÜÔ∏è Importer Projets (CSV)</button>
              <button id="btnImportActionsCSV">‚¨ÜÔ∏è Importer Actions (CSV)</button>
            </div>
          </div>
        </div>

        <div class="panel">
          <h3>Export / import sur mesure</h3>
          <div class="grid grid-2">
            <form id="formCustomExport" class="form" aria-label="Export personnalis√©">
              <h4>Exporter un pack Klaro</h4>
              <div class="checkbox-grid">
                <label><input type="checkbox" name="exportStores" value="globals" checked> Objectifs globaux</label>
                <label><input type="checkbox" name="exportStores" value="systems" checked> Objectifs syst√®me</label>
                <label><input type="checkbox" name="exportStores" value="projects" checked> Projets</label>
                <label><input type="checkbox" name="exportStores" value="actions" checked> Actions</label>
                <label><input type="checkbox" name="exportStores" value="routines"> Routines</label>
                <label><input type="checkbox" name="exportStores" value="routineTasks"> T√¢ches de routine</label>
                <label><input type="checkbox" name="exportStores" value="routineRuns"> Ex√©cutions de routine</label>
                <label><input type="checkbox" name="exportStores" value="files"> Pi√®ces jointes</label>
                <label><input type="checkbox" name="exportStores" value="templates"> Templates</label>
                <label><input type="checkbox" name="exportStores" value="audit"> Journal</label>
              </div>
              <label>Format
                <select name="exportFormat">
                  <option value="klaro">Pack Klaro (.klaro)</option>
                  <option value="json">JSON classique</option>
                </select>
              </label>
              <label>Filtre JSON (optionnel)
                <textarea name="exportFilter" rows="3" placeholder='{"projects":{"status":"En cours"}}'></textarea>
              </label>
              <div class="form-actions">
                <button type="submit">‚¨áÔ∏è Exporter sur mesure</button>
              </div>
            </form>
            <form id="formCustomImport" class="form" aria-label="Import personnalis√©">
              <h4>Importer un pack</h4>
              <p class="muted">S√©lectionnez un fichier .klaro ou .json pr√©alablement export√©. Les √©l√©ments coch√©s seront fusionn√©s ou remplac√©s suivant la strat√©gie choisie.</p>
              <input type="file" id="customImportFile" accept=".klaro,.json,application/json" />
              <div class="checkbox-grid">
                <label><input type="checkbox" name="importStores" value="globals" checked> Objectifs globaux</label>
                <label><input type="checkbox" name="importStores" value="systems" checked> Objectifs syst√®me</label>
                <label><input type="checkbox" name="importStores" value="projects" checked> Projets</label>
                <label><input type="checkbox" name="importStores" value="actions" checked> Actions</label>
                <label><input type="checkbox" name="importStores" value="routines"> Routines</label>
                <label><input type="checkbox" name="importStores" value="routineTasks"> T√¢ches de routine</label>
                <label><input type="checkbox" name="importStores" value="routineRuns"> Ex√©cutions de routine</label>
                <label><input type="checkbox" name="importStores" value="files"> Pi√®ces jointes</label>
                <label><input type="checkbox" name="importStores" value="templates"> Templates</label>
                <label><input type="checkbox" name="importStores" value="audit"> Journal</label>
              </div>
              <label>Strat√©gie
                <select name="importStrategy">
                  <option value="merge">Fusionner (ajouter / mettre √† jour)</option>
                  <option value="replace">Remplacer (vider et importer)</option>
                </select>
              </label>
              <div class="form-actions">
                <button type="submit">‚¨ÜÔ∏è Importer s√©lection</button>
              </div>
            </form>
          </div>
        </div>

        <div class="grid grid-2">
          <div class="panel">
            <h3>Int√©grit√© des donn√©es & QA</h3>
            <button id="btnScanIntegrity">üîé Scanner</button>
            <div id="integrityResults" class="muted" style="margin-top:8px;"></div>
          </div>
          <div class="panel">
            <h3>Snapshots (versions locales)</h3>
            <div class="form-actions">
              <button id="btnSnapshot">üíæ Cr√©er un snapshot</button>
            </div>
            <table class="table compact" id="tblSnapshots">
              <thead><tr><th>ID</th><th>Date</th><th>Taille</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="grid grid-2">
          <div class="panel">
            <h3>Pi√®ces jointes</h3>
            <input type="file" id="fileAttach" multiple />
            <label>Associer au projet (ID) <input id="attachProjectId" /></label>
            <div class="form-actions">
              <button id="btnUpload">‚¨ÜÔ∏è Ajouter</button>
            </div>
            <table class="table compact" id="tblFiles">
              <thead><tr><th>ID</th><th>Nom</th><th>Type</th><th>Taille</th><th>Projet</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="panel">
            <h3>Corbeille</h3>
            <table class="table compact" id="tblTrash">
              <thead><tr><th>Store</th><th>ID</th><th>Date</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="grid grid-2">
          <div class="panel">
            <h3>Journal (audit)</h3>
            <table class="table compact" id="tblAudit">
              <thead><tr><th>Date</th><th>Op</th><th>Store</th><th>ID</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <p class="muted">Donn√©es locales, aucune connexion serveur. **Aucun chiffrement** dans cette version.</p>
      </div>

      <div id="p-guide" class="tabpanel" role="tabpanel" aria-labelledby="tab-guide" aria-hidden="true" tabindex="-1">
        <h1>Guide de d√©marrage</h1>
        <div class="panel">
          <h3>Comprendre Klaro en 5 minutes</h3>
          <p>Cette section vous accompagne pas √† pas pour b√¢tir votre syst√®me d‚Äôex√©cution :</p>
          <ol>
            <li><strong>Objectifs globaux</strong>¬†: d√©finissez votre destination strat√©gique et les indicateurs cl√©s.</li>
            <li><strong>Syst√®mes</strong>¬†: traduisez chaque objectif en leviers op√©rationnels et assignez-leur des objectifs mesurables.</li>
            <li><strong>Projets</strong>¬†: d√©coupez vos syst√®mes en initiatives concr√®tes, reliez-les aux projets parents pour mod√©liser la hi√©rarchie.</li>
            <li><strong>Actions & routines</strong>¬†: planifiez les t√¢ches quotidiennes en pr√©cisant syst√©matiquement les objectifs temporels, de r√©sultat et de m√©thode.</li>
            <li><strong>Review</strong>¬†: utilisez le tableau de bord, les vues et la Red‚ÄëTeam pour piloter l‚Äôam√©lioration continue.</li>
          </ol>
          <p>Chaque fiche dispose du bouton ¬´¬†Options avanc√©es¬†¬ª pour enrichir vos donn√©es (KPI, budgets, risques, etc.). Les exports personnalis√©s vous permettent de sauvegarder ou partager un sous-ensemble cibl√© de donn√©es.</p>
        </div>
        <div class="panel">
          <h3>Bonnes pratiques</h3>
          <ul>
            <li>Gardez vos objectifs √† jour toutes les semaines pour valider les progr√®s.</li>
            <li>Exploitez les objectifs obligatoires (temps, r√©sultat, m√©thode) afin de clarifier les attentes avant d‚Äôex√©cuter une t√¢che.</li>
            <li>Activez le chronom√®tre depuis les vues du jour pour prot√©ger votre temps et mesurer vos estimations.</li>
            <li>Planifiez des routines Red‚ÄëTeam pour revoir les actions termin√©es avant archivage.</li>
          </ul>
          <p class="muted">Besoin d‚Äôaller plus loin¬†? Exportez une configuration Klaro personnalis√©e, partagez-la √† votre √©quipe, puis importez-la partiellement dans un nouvel espace.</p>
        </div>
      </div>
    </section>

    <!-- RED-TEAM -->
    <section id="view-redteam" class="view" aria-labelledby="h-redteam">
      <h1 id="h-redteam">Red‚ÄëTeam</h1>
      <p class="muted">Flux des t√¢ches n√©cessitant un retour d‚Äôexp√©rience. Les t√¢ches termin√©es sont list√©es ici tant que la Red‚ÄëTeam n‚Äôest pas valid√©e.</p>
      <table class="table" id="tblRedTeam">
        <thead>
          <tr><th>T√¢che</th><th>Date ajout</th><th>Statut</th><th></th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <h2>Validations diff√©r√©es (7 jours)</h2>
      <p class="muted">Les nouveaux objectifs et routines sont surveill√©s pendant une semaine. Confirmez-les ou supprimez-les d√©finitivement une fois l‚Äôutilit√© v√©rifi√©e.</p>
      <table class="table" id="tblValidationQueue">
        <thead>
          <tr><th>ID</th><th>Type</th><th>Nom</th><th>Cr√©√© le</th><th>√âch√©ance</th><th></th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <!-- Formulaire/bo√Æte modale pour traiter une entr√©e Red‚ÄëTeam -->
      <form id="formRedTeam" class="form collapsed" aria-label="Formulaire Red‚ÄëTeam">
        <h3 id="titleRedTeamForm">Traitement Red‚ÄëTeam</h3>
        <div class="grid grid-2">
          <label>Titre<input name="title" readonly /></label>
          <label>Dur√©e r√©elle estim√©e (min)<input type="text" name="duration" value="5‚Äì15" /></label>
          <label>Qu'est-ce qui a pris le plus de temps ?<textarea name="time" rows="2"></textarea></label>
          <label>Qu'est-ce qui a bien fonctionn√© ?<textarea name="success" rows="2"></textarea></label>
          <label>Qu'est-ce qui a drain√© l'√©nergie ?<textarea name="drain" rows="2"></textarea></label>
          <label>D√©cision corrective propos√©e<textarea name="decision" rows="2" required></textarea></label>
          <label>Cause structurelle identifi√©e<textarea name="cause" rows="2" required></textarea></label>
          <label>Impact observ√©<textarea name="impact" rows="2" required></textarea></label>
          <label>Correctif imm√©diat<textarea name="correctif" rows="2" required></textarea></label>
          <label>Le√ßon structurelle<textarea name="lesson" rows="2" required></textarea></label>
          <label>√ânergie (1‚Äì10)<input type="number" name="energy" min="1" max="10" required /></label>
          <label>Lien commit<input type="text" name="lien_commit" placeholder="URL ou identifiant commit" /></label>
        </div>
        <div class="form-actions">
          <button type="button" id="btnRedTeamStart" class="secondary">‚è±Ô∏è D√©marrer timer</button>
          <button type="button" id="btnRedTeamSave" class="secondary">üíæ Sauvegarder brouillon</button>
          <button type="submit" id="btnRedTeamCommit">‚úÖ Commit</button>
          <button type="button" id="btnRedTeamDismiss" class="secondary">‚õî Ignorer</button>
          <button type="button" id="btnRedTeamCancel" class="secondary">Annuler</button>
        </div>
      </form>
    </section>

    <div id="timerModal" class="timer-modal" hidden aria-hidden="true">
      <div class="timer-dialog" role="dialog" aria-modal="true" aria-labelledby="timerTitle">
        <h3 id="timerTitle">Chronom√®tre</h3>
        <p id="timerCountdown" class="timer-countdown">00:00</p>
        <p id="timerMessage" class="muted"></p>
        <div class="timer-controls">
          <button type="button" id="timerToggle">‚è∏Ô∏è Pause</button>
          <button type="button" id="timerReset">‚Ü∫ R√©initialiser</button>
          <button type="button" id="timerClose">‚úñÔ∏è Fermer</button>
        </div>
      </div>
    </div>

    <!-- TOAST -->
    <div id="toast" role="status" aria-live="polite" class="toast" hidden>OK</div>

  <!-- Global loading overlay displayed during lengthy operations -->
  <div id="loadingOverlay" class="loading-overlay" hidden aria-hidden="true">
    <div class="spinner" role="status" aria-label="Chargement‚Ä¶"></div>
  </div>
  </main>

  <footer class="footer" role="contentinfo">
    <!-- Mise √† jour du num√©ro de version affich√© en pied de page -->
        <!-- Mettre √† jour la version affich√©e dans le pied de page en coh√©rence avec APP_VERSION. -->
        <span>Offline ‚Ä¢ IndexedDB ‚Ä¢ v3.5.0</span>
  </footer>

  <!-- Append version as query parameter to force browsers and service workers to fetch the updated script -->
  <!-- The version query parameter forces browsers and the service worker
       to fetch the latest app.js after an upgrade. Ensure this value
       matches APP_VERSION in app.js. -->
  <!-- Librairie jsPDF pour g√©n√©rer des rapports PDF. Charg√©e depuis un CDN. -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="app.js?v=3.4.26"></script>
  <!-- Moteur d‚Äôauto‚Äëpriorisation pour calculer et appliquer des scores aux actions -->
  <script src="prioritizer.js?v=3.4.26"></script>
  <script>
  // PWA (optionnel): actif uniquement via http(s)
  if (location.protocol.startsWith('http') && 'serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  }
  </script>

  <!-- Impression PDF par √©l√©ment -->
  <section id="reportView" class=""></section>
</body>
</html>
